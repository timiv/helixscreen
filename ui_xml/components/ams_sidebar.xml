<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!--
    AMS Sidebar - Shared right-column component for AMS panels.

    Contains: current loaded card, status/progress display, action buttons, dryer card.
    Used by both ams_panel.xml and ams_overview_panel.xml.

    Callbacks (registered by AmsOperationSidebar::register_callbacks_static()):
    - ams_sidebar_bypass_toggled: Bypass toggle switch
    - ams_sidebar_unload_clicked: Unload button
    - ams_sidebar_reset_clicked: Reset button
    - ams_sidebar_settings_clicked: Settings button

    C++ companion: AmsOperationSidebar (ui_ams_sidebar.h)
  -->
  <view name="ams_sidebar" extends="lv_obj"
        width="100%" height="100%" style_pad_all="0" scrollable="false" flex_flow="column"
        style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
    <!-- Currently Loaded Section Header (e.g., "Current: Slot 1") -->
    <text_small width="100%" bind_text="ams_current_slot_text"/>
    <!-- Shared loaded card component -->
    <ams_loaded_card name="current_loaded_card"/>
    <!-- Status Section -->
    <lv_obj name="status_section"
            width="100%" height="content" style_pad_all="#space_sm" flex_flow="row" style_flex_main_place="center"
            style_flex_cross_place="center" style_pad_gap="#space_sm" scrollable="false">
      <!-- Status label - bound to ams_action_detail subject -->
      <text_body name="status_label" bind_text="ams_action_detail" style_text_align="center" flex_grow="1"/>
    </lv_obj>
    <!-- Step Progress Stepper (shown during load operations) -->
    <lv_obj name="progress_stepper_container"
            width="100%" height="150" style_pad_all="0" scrollable="false" hidden="true">
      <!-- Step progress widget created dynamically by AmsOperationSidebar -->
    </lv_obj>
    <!-- Flex spacer - pushes action buttons to bottom of column -->
    <lv_obj width="1" style_pad_all="0" scrollable="false" flex_grow="1"/>
    <!-- Action Buttons Container - hidden during ANY operation (ams_action != IDLE) -->
    <lv_obj name="action_buttons_container" width="100%"
            height="content" style_pad_all="0" style_pad_gap="#space_sm" flex_flow="column"
            style_flex_main_place="start" style_flex_cross_place="center" scrollable="false">
      <bind_flag_if_not_eq subject="ams_action" flag="hidden" ref_value="0"/>
      <!-- Bypass Toggle Row (only shown if bypass supported - separate concern from action state) -->
      <lv_obj name="bypass_row"
              width="100%" height="#button_height" style_pad_all="0" flex_flow="row"
              style_flex_main_place="space_between" style_flex_cross_place="center" scrollable="false">
        <bind_flag_if_eq subject="ams_supports_bypass" flag="hidden" ref_value="0"/>
        <!-- Left side: icon + label -->
        <lv_obj height="content"
                style_pad_all="0" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xs"
                scrollable="false">
          <icon src="source_branch" size="sm"/>
          <text_body text="Bypass" translation_tag="Bypass"/>
        </lv_obj>
        <!-- Right side: toggle switch - state bound to ams_bypass_active subject -->
        <ui_switch name="bypass_switch" size="small">
          <bind_state_if_eq subject="ams_bypass_active" state="checked" ref_value="1"/>
          <event_cb trigger="value_changed" callback="ams_sidebar_bypass_toggled"/>
        </ui_switch>
      </lv_obj>
      <!-- Unload Button (full width) - hidden for tool changers -->
      <ui_button name="btn_unload" width="100%" variant="secondary" icon="tray_arrow_up" text="Unload" translation_tag="Unload">
        <bind_flag_if_eq subject="ams_type" flag="hidden" ref_value="4"/>
        <bind_state_if_eq subject="ams_filament_loaded" state="disabled" ref_value="0"/>
        <event_cb trigger="clicked" callback="ams_sidebar_unload_clicked"/>
      </ui_button>
      <!-- Reset Button (full width) - hidden for tool changers -->
      <ui_button name="btn_reset" width="100%" variant="secondary" icon="refresh" text="Reset" translation_tag="Reset">
        <bind_flag_if_eq subject="ams_type" flag="hidden" ref_value="4"/>
        <event_cb trigger="clicked" callback="ams_sidebar_reset_clicked"/>
      </ui_button>
      <!-- Settings Button (full width) -->
      <ui_button name="btn_settings" width="100%" icon="settings" text="Settings" translation_tag="Settings">
        <event_cb trigger="clicked" callback="ams_sidebar_settings_clicked"/>
      </ui_button>
    </lv_obj>
    <!-- Dryer Card (hidden when dryer not supported or for tool changers) -->
    <ams_dryer_card name="dryer_card"/>
    <!-- Visibility controlled by binding inside ams_dryer_card.xml -->
  </view>
</component>
