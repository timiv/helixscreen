<?xml version="1.0"?>
<!--
  Copyright (C) 2025 356C LLC
  Author: Preston Brown <pbrown@brown-house.net>

  This file is part of HelixScreen.

  HelixScreen is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  HelixScreen is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with HelixScreen. If not, see <https://www.gnu.org/licenses/>.
-->

<component>
  <!-- Filament Management Panel -->
  <!-- Two-column layout: left (visualization + status), right (controls) -->

  <view extends="lv_obj"
        name="filament_panel"
        width="100%"
        height="100%"
        style_bg_color="#panel_bg"
        style_border_width="0"
        style_pad_all="#padding_normal"
        scrollable="false"
        flex_flow="row"
        style_flex_main_place="space_between"
        style_pad_gap="#padding_normal">

    <!-- ================================================================== -->
    <!-- LEFT COLUMN: Visualization & Temperature Status                   -->
    <!-- ================================================================== -->
    <lv_obj name="left_column" width="40%" height="100%"
            style_bg_opa="0" style_pad_all="0" style_border_width="0"
            scrollable="false"
            flex_flow="column" style_flex_main_place="start"
            style_pad_gap="#padding_normal">

      <!-- Filament Spool Visualization Card -->
      <lv_obj name="spool_visualization" width="100%" height="320"
              style_bg_color="#card_bg" style_radius="#card_radius_large" style_pad_all="#padding_card"
              style_border_width="0"
              scrollable="false"
              flex_flow="column" style_flex_main_place="center" style_flex_cross_place="center">
        <!-- Filament spool placeholder (TODO: add actual image) -->
        <icon src="mat_filament" size="xl" variant="primary"/>
        <lv_label text="Filament Spool"
                  style_text_font="montserrat_16"
                  style_text_color="#text_secondary"
                  style_pad_top="#gap_normal"
                  align="center"/>
      </lv_obj>

      <!-- Temperature Status Card -->
      <lv_obj name="temp_status_card" width="100%" height="140"
              style_bg_color="#card_bg" style_radius="#card_radius_large" style_pad_all="#padding_card_emphasis"
              style_border_width="0"
              scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
              style_pad_gap="#gap_normal">

        <!-- Header -->
        <lv_label text="Nozzle Temperature"
                  style_text_font="montserrat_16"
                  style_text_color="#text_secondary"
                  align="center"/>

        <!-- Temperature Display (Current / Target) -->
        <lv_label name="temp_display"
                  bind_text="filament_temp_display"
                  style_text_font="montserrat_28"
                  style_text_color="#text_primary"
                  align="center"/>

        <!-- Status Indicator -->
        <lv_label name="status_indicator"
                  bind_text="filament_status"
                  style_text_font="montserrat_14"
                  style_text_color="#text_secondary"
                  align="center"/>
      </lv_obj>
    </lv_obj>

    <!-- ================================================================== -->
    <!-- RIGHT COLUMN: Material Selection & Actions                        -->
    <!-- ================================================================== -->
    <lv_obj name="right_column" width="58%" height="100%"
            style_bg_opa="0" style_pad_all="0" style_border_width="0"
            scrollable="false"
            flex_flow="column" style_flex_main_place="start"
            style_pad_gap="12">

      <!-- Material Selection Header -->
      <lv_label text="Material Selection"
                style_text_font="montserrat_16"
                style_text_color="#text_secondary"
                align="left_mid"/>

      <!-- Material Preset Buttons (2x2 Grid) -->
      <lv_obj name="preset_grid" width="100%" height="116"
              style_bg_opa="0" style_pad_all="0" style_border_width="0"
              scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
              style_pad_gap="#gap_small">

        <!-- Row 1: PLA, PETG -->
        <lv_obj width="100%" height="#button_height"
                style_bg_opa="0" style_border_width="0" style_pad_all="0"
                scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#gap_normal">
          <lv_button name="preset_pla" flex_grow="1" height="#button_height"
                     style_bg_color="#jog_button_bg" style_radius="#gap_tiny" style_border_width="0"
                     flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                     style_pad_gap="#gap_tiny">
            <icon src="mat_leaf" size="xs" variant="primary"/>
            <lv_label text="PLA" style_text_font="#font_body" style_text_color="#text_primary"/>
          </lv_button>

          <lv_button name="preset_petg" flex_grow="1" height="#button_height"
                     style_bg_color="#jog_button_bg" style_radius="#gap_tiny" style_border_width="0"
                     flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                     style_pad_gap="#gap_tiny">
            <lv_label text="#icon_cube" style_text_font="fontawesome_16" style_text_color="#text_primary"/>
            <lv_label text="PETG" style_text_font="#font_body" style_text_color="#text_primary"/>
          </lv_button>
        </lv_obj>

        <!-- Row 2: ABS, Custom -->
        <lv_obj width="100%" height="#button_height"
                style_bg_opa="0" style_border_width="0" style_pad_all="0"
                scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#gap_normal">
          <lv_button name="preset_abs" flex_grow="1" height="#button_height"
                     style_bg_color="#jog_button_bg" style_radius="#gap_tiny" style_border_width="0"
                     flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                     style_pad_gap="#gap_tiny">
            <lv_label text="#icon_fire" style_text_font="fontawesome_16" style_text_color="#text_primary"/>
            <lv_label text="ABS" style_text_font="#font_body" style_text_color="#text_primary"/>
          </lv_button>

          <lv_button name="preset_custom" flex_grow="1" height="#button_height"
                     style_bg_color="#jog_button_bg" style_radius="#gap_tiny" style_border_width="0"
                     flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                     style_pad_gap="#gap_tiny">
            <lv_label text="#icon_edit" style_text_font="fontawesome_16" style_text_color="#text_primary"/>
            <lv_label text="Custom..." style_text_font="#font_body" style_text_color="#text_primary"/>
          </lv_button>
        </lv_obj>
      </lv_obj>

      <!-- Filament Operations Header -->
      <lv_label text="Filament Operations"
                style_text_font="montserrat_16"
                style_text_color="#text_secondary"
                style_pad_top="#gap_normal"
                align="left_mid"/>

      <!-- Action Buttons (Vertical Stack) -->
      <lv_obj name="action_buttons" width="100%" height="220"
              style_bg_opa="0" style_pad_all="0" style_border_width="0"
              scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
              style_pad_gap="#padding_small">

        <!-- Load Filament Button -->
        <lv_button name="btn_load" width="100%" height="68"
                   style_bg_color="#success_color" style_radius="#gap_tiny" style_border_width="0"
                   flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                   style_pad_gap="#gap_small"
                   clickable="true">
          <lv_label text="#icon_arrow_down_to_line" style_text_font="#font_heading" style_text_color="#text_primary"/>
          <lv_label text="Load Filament"
                    style_text_font="#font_heading"
                    style_text_color="#text_primary"/>
        </lv_button>

        <!-- Unload Filament Button -->
        <lv_button name="btn_unload" width="100%" height="68"
                   style_bg_color="#warning_color" style_radius="#gap_tiny" style_border_width="0"
                   flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                   style_pad_gap="#gap_small"
                   clickable="true">
          <lv_label text="#icon_arrow_up_line" style_text_font="#font_heading" style_text_color="#text_primary"/>
          <lv_label text="Unload Filament"
                    style_text_font="#font_heading"
                    style_text_color="#text_primary"/>
        </lv_button>

        <!-- Purge Button -->
        <lv_button name="btn_purge" width="100%" height="68"
                   style_bg_color="0x2196f3" style_radius="#gap_tiny" style_border_width="0"
                   flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                   style_pad_gap="#gap_small"
                   clickable="true">
          <lv_label text="#icon_droplet" style_text_font="#font_heading" style_text_color="#text_primary"/>
          <lv_label text="Purge 10mm"
                    style_text_font="#font_heading"
                    style_text_color="#text_primary"/>
        </lv_button>
      </lv_obj>

      <!-- Safety Warning Card (Visible when temp < 170°C) -->
      <lv_obj name="safety_warning" width="100%" flex_grow="1"
              style_bg_color="0x331111" style_bg_opa="100%"
              style_border_color="0xff4444" style_border_width="2"
              style_radius="#card_radius" style_pad_all="#padding_card"
              scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_flex_cross_place="start"
              style_pad_gap="#gap_small">

        <!-- Warning Title (icon + text in single label) -->
        <lv_obj width="100%" height="#label_height_md"
                style_bg_opa="0" style_pad_all="0" style_border_width="0"
                scrollable="false"
                flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#gap_tiny">
          <lv_label text="#icon_triangle_exclamation" style_text_font="#font_body" style_text_color="0xff4444"/>
          <lv_label text="Nozzle Too Cold" style_text_font="#font_body" style_text_color="0xff4444"/>
        </lv_obj>

        <!-- Warning Message -->
        <lv_label text="Heat nozzle to at least 170°C before loading or unloading filament."
                  width="100%"
                  style_text_font="montserrat_14"
                  style_text_color="#text_secondary"
                  align="left_mid"/>

        <!-- Current Temp Display -->
        <lv_label name="warning_temps"
                  bind_text="filament_warning_temps"
                  style_text_font="montserrat_14"
                  style_text_color="#text_secondary"
                  style_pad_top="#gap_tiny"
                  align="left_mid"/>
      </lv_obj>
    </lv_obj>
  </view>
</component>
