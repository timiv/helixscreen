<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Styles for reactive purge button state binding (L040: no inline bg attrs) -->
  <styles>
    <style name="purge_btn_selected" bg_color="#primary" bg_opa="255"/>
    <style name="purge_btn_unselected" bg_color="#primary" bg_opa="40"/>
  </styles>
  <consts>
    <!-- Temperature card spacing -->
    <px name="temp_card_spacing_tiny" value="2"/>
    <px name="temp_card_spacing_small" value="8"/>
    <px name="temp_card_spacing_medium" value="10"/>
    <px name="temp_card_spacing_large" value="12"/>

    <!-- Spacing overrides for temperature preset buttons -->
    <px name="temp_preset_btn_spacing_tiny" value="1"/>
    <px name="temp_preset_btn_spacing_small" value="6"/>
    <px name="temp_preset_btn_spacing_medium" value="7"/>
    <px name="temp_preset_btn_spacing_large" value="8"/>
  </consts>
  <!-- Filament Management Panel -->
  <!-- Two-column layout: left (temp status + AMS), right (material + operations) -->
  <view name="filament_panel"
        extends="lv_obj" width="100%" height="100%" style_border_width="0" style_pad_all="#space_md" scrollable="false"
        flex_flow="row" style_flex_cross_place="start" style_pad_gap="#space_md" style_bg_color="#screen_bg">

    <!-- ================================================================== -->
    <!-- LEFT COLUMN: Temperature Status & AMS                              -->
    <!-- ================================================================== -->
    <lv_obj name="left_column"
            width="40%" height="100%" style_pad_all="0" scrollable="false"
            flex_flow="column" style_flex_main_place="start" style_pad_gap="#space_md">

        <!-- Temperature Status Card - shows both nozzle and bed -->
        <ui_card name="temp_status_card"
                 width="100%" style_pad_all="#space_lg" style_pad_gap="#temp_card_spacing"
                 flex_flow="column" style_flex_main_place="start" style_flex_cross_place="start">

          <!-- Header row with icon -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
            <icon src="thermometer" size="sm" variant="secondary"/>
            <text_body text="Temperature" translation_tag="Temperature" style_translate_y="2"/>
          </lv_obj>

          <!-- Nozzle Row: Current / Target (entire row tappable) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center" clickable="true">
            <event_cb trigger="clicked" callback="on_filament_nozzle_target_tap"/>
            <text_small bind_text="filament_nozzle_label" clickable="false" event_bubble="true"/>
            <lv_obj
                    height="content" flex_flow="row" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="false"
                    event_bubble="true">
              <text_body name="nozzle_current_temp"
                         bind_text="filament_nozzle_current" clickable="false" event_bubble="true"/>
              <text_body text="/" clickable="false" event_bubble="true"/>
              <lv_obj name="nozzle_target_tap"
                      width="content" height="content" style_pad_all="#space_xs"
                      scrollable="false" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xs"
                      clickable="false" event_bubble="true">
                <text_body name="nozzle_target_temp"
                           bind_text="filament_nozzle_target" clickable="false" event_bubble="true"/>
                <icon src="pencil" size="xs" variant="secondary" clickable="false" event_bubble="true"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Bed Row: Current / Target (entire row tappable) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center" clickable="true">
            <event_cb trigger="clicked" callback="on_filament_bed_target_tap"/>
            <text_small text="Bed" translation_tag="Bed" clickable="false" event_bubble="true"/>
            <lv_obj
                    height="content" flex_flow="row" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="false"
                    event_bubble="true">
              <text_body name="bed_current_temp" bind_text="filament_bed_current" clickable="false" event_bubble="true"/>
              <text_body text="/" clickable="false" event_bubble="true"/>
              <lv_obj name="bed_target_tap"
                      width="content" height="content" style_pad_all="#space_xs"
                      scrollable="false" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xs"
                      clickable="false" event_bubble="true">
                <text_body name="bed_target_temp" bind_text="filament_bed_target" clickable="false" event_bubble="true"/>
                <icon src="pencil" size="xs" variant="secondary" clickable="false" event_bubble="true"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Status Indicator (icon + text row) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                  style_pad_gap="#space_xs">
            <bind_flag_if_eq subject="ui_breakpoint" flag="hidden" ref_value="0"/>
            <icon name="status_icon" src="info" size="xs" variant="secondary"/>
            <text_small name="status_text" bind_text="filament_status"/>
          </lv_obj>
        </ui_card> <!-- temp card -->

        <!-- Temperature Graph (combined nozzle + bed) -->
        <lv_obj name="temp_graph_card"
                 width="100%" flex_grow="1" style_pad_all="0" scrollable="false">
          <!-- Graph container - populated by C++ via TempControlPanel -->
          <lv_obj name="temp_graph_container"
                  width="100%" height="100%" style_pad_all="0"/>
        </lv_obj>

      <!-- BOTTOM: Multi-Filament Card (visible when AMS or multi-tool, managed by C++) -->
      <ui_card name="ams_status_card"
               width="100%" style_radius="#border_radius" style_pad_all="#space_md" flex_flow="column"
               style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm"
               flags="hidden">
        <!-- Header row with icon -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
          <icon src="filament" size="sm" variant="secondary"/>
          <text_body text="Multi-Filament" translation_tag="Multi-Filament" style_translate_y="2"/>
        </lv_obj>

        <!-- AMS mini status + action widget row -->
        <lv_obj name="ams_manage_row" width="100%" height="#button_height_lg"
                style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#space_sm"
                flags="hidden">

          <!-- AMS mini status (auto-binds to AmsState, fills width) -->
          <ams_mini_status flex_grow="1"/>
          <!-- Manage Button (shown when single-tool AMS, hidden when multi-tool) -->
          <ui_button name="btn_manage_slots"
                     width="content" text="Manage" translation_tag="Manage"
                     style_pad_left="#space_md" style_pad_right="#space_md">
            <event_cb trigger="clicked" callback="filament_manage_slots_cb"/>
          </ui_button>
          <!-- Extruder Dropdown (shown when multi-tool, replaces Manage button) -->
          <lv_obj name="extruder_selector_group"
                  width="content" height="content" style_pad_all="0" scrollable="false"
                  flex_flow="column" style_flex_cross_place="start" style_pad_gap="2"
                  flags="hidden">
          <text_small text="Tool" translation_tag="Tool"/>
          <lv_dropdown name="extruder_dropdown"
                       width="content" height="content" style_min_width="80"
                       style_radius="#border_radius_sm" style_pad_all="#space_sm">
            <event_cb trigger="value_changed" callback="on_extruder_dropdown_changed"/>
          </lv_dropdown>
          </lv_obj>
        </lv_obj>
      </ui_card>
    </lv_obj>
    <!-- ================================================================== -->
    <!-- RIGHT COLUMN: Material Selection & Actions                        -->
    <!-- ================================================================== -->
    <lv_obj name="right_column"
            width="58%" height="100%" style_pad_all="0" scrollable="false"
            style_layout="flex" style_flex_flow="column" style_flex_main_place="space_between" style_pad_gap="#space_sm">
      <!-- TOP GROUP: Material Selection + Selected Temps (grouped as one flex child) -->
      <lv_obj name="material_group"
              width="100%" height="content" style_pad_all="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_md">
        <!-- Material Selection Header -->
        <text_body text="Material" translation_tag="Material" align="left_mid"/>
        <!-- Material Preset Buttons (2x2 Grid: PLA, PETG, ABS, TPU) -->
        <lv_obj name="preset_grid"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- Row 1: PLA, PETG -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <ui_button name="preset_pla" height="content" flex_grow="1" layout="column"
                       state_trickle="true" style_pad_ver="#space_sm" style_pad_gap="#temp_preset_btn_spacing">
              <event_cb trigger="clicked" callback="on_filament_preset_pla"/>
              <text_body text="PLA" translation_tag="PLA" style_text_color:checked="#text"/>
              <text_small text="210°C / 60°C" translation_tag="210°C / 60°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
            <ui_button name="preset_petg" height="content" flex_grow="1" layout="column"
                       state_trickle="true" style_pad_ver="#space_sm" style_pad_gap="#temp_preset_btn_spacing">
              <event_cb trigger="clicked" callback="on_filament_preset_petg"/>
              <text_body text="PETG" translation_tag="PETG" style_text_color:checked="#text"/>
              <text_small text="240°C / 80°C" translation_tag="240°C / 80°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
          </lv_obj>
          <!-- Row 2: ABS, TPU -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <ui_button name="preset_abs" height="content" flex_grow="1" layout="column"
                       state_trickle="true" style_pad_ver="#space_sm" style_pad_gap="#temp_preset_btn_spacing">
              <event_cb trigger="clicked" callback="on_filament_preset_abs"/>
              <text_body text="ABS" translation_tag="ABS" style_text_color:checked="#text"/>
              <text_small text="250°C / 100°C" translation_tag="250°C / 100°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
            <ui_button name="preset_tpu" height="content" flex_grow="1" layout="column"
                       state_trickle="true" style_pad_ver="#space_sm" style_pad_gap="#temp_preset_btn_spacing">
              <event_cb trigger="clicked" callback="on_filament_preset_tpu"/>
              <text_body text="TPU" translation_tag="TPU" style_text_color:checked="#text"/>
              <text_small text="230°C / 50°C" translation_tag="230°C / 50°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
          </lv_obj>
        </lv_obj>
        <!-- Cooldown Button (visible when heating) -->
        <ui_button name="btn_cooldown"
                   width="100%" height="#button_height"
                   style_bg_color="#temp_gradient_cold" icon="cooldown" text="Cool Down" translation_tag="Cool Down">
          <bind_flag_if_eq subject="filament_nozzle_heating" flag="hidden" ref_value="0"/>
          <event_cb trigger="clicked" callback="on_filament_cooldown"/>
        </ui_button>
      </lv_obj>
      <!-- BOTTOM GROUP: Operations (second flex child, pushed to bottom by space_between) -->
      <lv_obj name="operations_group"
              width="100%" height="content" style_pad_all="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_sm">
        <!-- Filament Operations Header -->
        <text_body text="Operations" translation_tag="Operations" align="left_mid"/>
        <!-- Load/Unload/Purge Row (macro-based, no length selector) -->
        <lv_obj width="100%"
                height="#button_height" style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <ui_button name="btn_load"
                     height="#button_height" flex_grow="1" icon="arrow_down" text="Load" translation_tag="Load">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_load"/>
          </ui_button>
          <ui_button name="btn_unload"
                     height="#button_height" flex_grow="1" icon="arrow_up" text="Unload" translation_tag="Unload">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_unload"/>
          </ui_button>
          <ui_button name="btn_purge"
                     height="#button_height" flex_grow="1" icon="trash_can_outline" text="Purge" translation_tag="Purge">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_purge"/>
          </ui_button>
        </lv_obj>
        <!-- Length Selector -->
        <lv_obj name="purge_amount_row"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <text_small text="Length:" translation_tag="Length:"/>
          <ui_button name="purge_5mm"
                     height="#button_height_sm" flex_grow="1" text="5mm" translation_tag="5mm">
            <bind_style name="purge_btn_selected" subject="filament_purge_5mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_5mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_5mm"/>
          </ui_button>
          <ui_button name="purge_10mm"
                     height="#button_height_sm" flex_grow="1" text="10mm" translation_tag="10mm">
            <bind_style name="purge_btn_selected" subject="filament_purge_10mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_10mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_10mm"/>
          </ui_button>
          <ui_button name="purge_25mm"
                     height="#button_height_sm" flex_grow="1" text="25mm" translation_tag="25mm">
            <bind_style name="purge_btn_selected" subject="filament_purge_25mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_25mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_25mm"/>
          </ui_button>
        </lv_obj>
        <!-- Extrude/Retract Row (length-based operations) -->
        <lv_obj width="100%"
                height="#button_height" style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <ui_button name="btn_extrude"
                     height="#button_height" flex_grow="1" icon="arrow_down" text="Extrude" translation_tag="Extrude">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_extrude"/>
          </ui_button>
          <ui_button name="btn_retract"
                     height="#button_height" flex_grow="1" icon="arrow_up" text="Retract" translation_tag="Retract">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_retract"/>
          </ui_button>
        </lv_obj>
        <!-- Safety Warning (compact inline - shows when cold) -->
        <lv_obj name="safety_warning"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_flex_track_place="center" style_pad_gap="#space_xs">
          <bind_flag_if_eq subject="filament_safety_warning_visible" flag="hidden" ref_value="0"/>
          <icon src="alert" size="sm" variant="warning"/>
          <text_small bind_text="filament_safety_warning_text"/>
        </lv_obj>
      </lv_obj>
    </lv_obj>
  </view>
</component>
