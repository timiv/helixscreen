<?xml version="1.0"?>
<!-- Copyright 2025 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Filament Management Panel -->
  <!-- Two-column layout: left (temp status + AMS), right (material + operations) -->
  <view name="filament_panel"
        extends="lv_obj" width="100%" height="100%" style_border_width="0" style_pad_all="#space_lg" scrollable="false"
        flex_flow="row" style_flex_cross_place="start" style_pad_gap="#space_lg" style_bg_color="#app_bg_color">
    <!-- ================================================================== -->
    <!-- LEFT COLUMN: Temperature Status & AMS                              -->
    <!-- ================================================================== -->
    <lv_obj name="left_column"
            width="40%" height="100%" style_bg_opa="0" style_pad_all="0" style_border_width="0" scrollable="false"
            flex_flow="column" style_flex_main_place="space_between" style_pad_gap="#space_lg">
      <!-- TOP GROUP: Temperature displays -->
      <lv_obj name="temp_group"
              width="100%" height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0" scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_pad_gap="#space_lg">
        <!-- Temperature Status Card - shows both nozzle and bed -->
        <ui_card name="temp_status_card"
                 width="100%" height="content" style_radius="#border_radius_large" style_pad_all="#space_lg"
                 flex_flow="column" style_flex_main_place="start" style_flex_cross_place="start"
                 style_pad_gap="#space_md">
          <!-- Header -->
          <text_body text="Temperature" align="left_mid"/>
          <!-- Nozzle Row: Current / Target (target tappable) -->
          <lv_obj width="100%"
                  height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center">
            <text_small text="Nozzle"/>
            <lv_obj width="content"
                    height="content" flex_flow="row" style_bg_opa="0" style_border_width="0" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs">
              <text_body name="nozzle_current_temp" bind_text="filament_nozzle_current"/>
              <text_body text="/"/>
              <lv_obj name="nozzle_target_tap"
                      width="content" height="content" clickable="true" style_bg_opa="0" style_border_width="0"
                      style_pad_all="#space_xs" scrollable="false" flex_flow="row" style_flex_cross_place="center"
                      style_pad_gap="#space_xs">
                <event_cb trigger="clicked" callback="on_filament_nozzle_target_tap"/>
                <text_body name="nozzle_target_temp" bind_text="filament_nozzle_target"/>
                <icon src="pencil" size="xs" variant="secondary"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Bed Row: Current / Target (target tappable) -->
          <lv_obj width="100%"
                  height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center">
            <text_small text="Bed"/>
            <lv_obj width="content"
                    height="content" flex_flow="row" style_bg_opa="0" style_border_width="0" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs">
              <text_body name="bed_current_temp" bind_text="filament_bed_current"/>
              <text_body text="/"/>
              <lv_obj name="bed_target_tap"
                      width="content" height="content" clickable="true" style_bg_opa="0" style_border_width="0"
                      style_pad_all="#space_xs" scrollable="false" flex_flow="row" style_flex_cross_place="center"
                      style_pad_gap="#space_xs">
                <event_cb trigger="clicked" callback="on_filament_bed_target_tap"/>
                <text_body name="bed_target_temp" bind_text="filament_bed_target"/>
                <icon src="pencil" size="xs" variant="secondary"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Status Indicator (icon + text row) -->
          <lv_obj width="100%"
                  height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                  style_pad_gap="#space_xs">
            <icon name="status_icon" src="info" size="xs" variant="secondary"/>
            <text_small name="status_text" bind_text="filament_status"/>
          </lv_obj>
        </ui_card>
        <!-- Temperature Graph Card (combined nozzle + bed) -->
        <ui_card name="temp_graph_card"
                 width="100%" height="120" style_radius="#border_radius" style_pad_all="#space_sm">
          <!-- Graph container - populated by C++ via TempControlPanel -->
          <lv_obj name="temp_graph_container"
                  width="100%" height="100%" style_bg_opa="0" style_border_width="0" style_pad_all="0"/>
        </ui_card>
      </lv_obj>
      <!-- BOTTOM: AMS Multi-Filament Card (hidden if no AMS) -->
      <ui_card name="ams_status_card"
               width="100%" height="content" style_radius="#border_radius" style_pad_all="#space_md" flex_flow="column"
               style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
        <lv_obj-bind_flag_if_eq subject="ams_type" flag="hidden" ref_value="0"/>
        <!-- Header row with icon -->
        <lv_obj width="100%"
                height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0" scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center">
          <text_body text="Multi-Filament"/>
          <icon src="filament" size="sm" variant="primary"/>
        </lv_obj>
        <!-- AMS mini status container (populated by C++) -->
        <lv_obj name="ams_mini_container" width="100%" height="40" style_bg_opa="0" style_border_width="0"/>
        <!-- Manage Slots Button -->
        <lv_button name="btn_manage_slots"
                   width="100%" height="#button_height" style_radius="#border_radius" style_border_width="0">
          <event_cb trigger="clicked" callback="filament_manage_slots_cb"/>
          <text_body text="Manage Slots" align="center"/>
        </lv_button>
      </ui_card>
    </lv_obj>
    <!-- ================================================================== -->
    <!-- RIGHT COLUMN: Material Selection & Actions                        -->
    <!-- ================================================================== -->
    <lv_obj name="right_column"
            width="58%" height="100%" style_bg_opa="0" style_pad_all="0" style_border_width="0" scrollable="false"
            style_layout="flex" style_flex_flow="column" style_flex_main_place="space_between" style_pad_gap="#space_sm">
      <!-- TOP GROUP: Material Selection + Selected Temps (grouped as one flex child) -->
      <lv_obj name="material_group"
              width="100%" height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_md">
        <!-- Material Selection Header -->
        <text_body text="Material" align="left_mid"/>
        <!-- Material Preset Buttons (2x2 Grid: PLA, PETG, ABS, TPU) -->
        <lv_obj name="preset_grid"
                width="100%" height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0"
                scrollable="false" flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- Row 1: PLA, PETG -->
          <lv_obj width="100%"
                  height="#button_height" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <lv_button name="preset_pla"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0">
              <event_cb trigger="clicked" callback="on_filament_preset_pla"/>
              <text_body text="PLA" align="center"/>
            </lv_button>
            <lv_button name="preset_petg"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0">
              <event_cb trigger="clicked" callback="on_filament_preset_petg"/>
              <text_body text="PETG" align="center"/>
            </lv_button>
          </lv_obj>
          <!-- Row 2: ABS, TPU -->
          <lv_obj width="100%"
                  height="#button_height" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <lv_button name="preset_abs"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0">
              <event_cb trigger="clicked" callback="on_filament_preset_abs"/>
              <text_body text="ABS" align="center"/>
            </lv_button>
            <lv_button name="preset_tpu"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0">
              <event_cb trigger="clicked" callback="on_filament_preset_tpu"/>
              <text_body text="TPU" align="center"/>
            </lv_button>
          </lv_obj>
        </lv_obj>
        <!-- Selected Material Info (Nozzle/Bed target temps) - tappable for custom input -->
        <lv_obj width="100%"
                height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                flex_flow="row" style_pad_gap="#space_xl">
          <!-- Nozzle target (tappable) -->
          <lv_obj name="nozzle_temp_tap"
                  flex_flow="row" style_bg_opa="0" style_border_width="0" style_pad_all="#space_xs"
                  style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="true" scrollable="false">
            <event_cb trigger="clicked" callback="on_filament_nozzle_temp_tap"/>
            <lv_obj flex_flow="column" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false">
              <text_small text="Nozzle Target"/>
              <text_body name="material_nozzle_temp" bind_text="filament_material_nozzle_temp"/>
            </lv_obj>
            <icon src="pencil" size="xs" variant="secondary"/>
          </lv_obj>
          <!-- Bed target (tappable) -->
          <lv_obj name="bed_temp_tap"
                  flex_flow="row" style_bg_opa="0" style_border_width="0" style_pad_all="#space_xs"
                  style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="true" scrollable="false">
            <event_cb trigger="clicked" callback="on_filament_bed_temp_tap"/>
            <lv_obj flex_flow="column" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false">
              <text_small text="Bed Target"/>
              <text_body name="material_bed_temp" bind_text="filament_material_bed_temp"/>
            </lv_obj>
            <icon src="pencil" size="xs" variant="secondary"/>
          </lv_obj>
        </lv_obj>
      </lv_obj>
      <!-- BOTTOM GROUP: Operations (second flex child, pushed to bottom by space_between) -->
      <lv_obj name="operations_group"
              width="100%" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_sm">
        <!-- Filament Operations Header -->
        <text_body text="Operations" align="left_mid"/>
        <!-- Purge Amount Selector -->
        <lv_obj name="purge_amount_row"
                width="100%" height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <text_small text="Length:"/>
          <lv_button name="purge_5mm"
                     width="content" height="#button_height_small" style_radius="#border_radius"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_border_width="0">
            <event_cb trigger="clicked" callback="on_filament_purge_5mm"/>
            <text_small text="5mm" align="center"/>
          </lv_button>
          <lv_button name="purge_10mm"
                     width="content" height="#button_height_small" style_radius="#border_radius"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_border_width="0">
            <event_cb trigger="clicked" callback="on_filament_purge_10mm"/>
            <text_small text="10mm" align="center"/>
          </lv_button>
          <lv_button name="purge_25mm"
                     width="content" height="#button_height_small" style_radius="#border_radius"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_border_width="0">
            <event_cb trigger="clicked" callback="on_filament_purge_25mm"/>
            <text_small text="25mm" align="center"/>
          </lv_button>
        </lv_obj>
        <!-- Action Buttons: Load/Unload side-by-side, Purge below -->
        <lv_obj name="action_buttons"
                width="100%" height="content" style_bg_opa="0" style_pad_all="0" style_border_width="0"
                scrollable="false" flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- Load/Unload Row -->
          <lv_obj width="100%"
                  height="#button_height" style_bg_opa="0" style_border_width="0" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_sm">
            <lv_button name="btn_load"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0"
                       flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                       style_flex_track_place="center" style_pad_gap="#space_xs">
              <event_cb trigger="clicked" callback="on_filament_load"/>
              <lv_obj-bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
              <lv_obj-bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
              <icon src="arrow_down" size="sm" variant="primary"/>
              <text_body text="Load"/>
            </lv_button>
            <lv_button name="btn_unload"
                       height="#button_height" flex_grow="1" style_radius="#border_radius" style_border_width="0"
                       flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                       style_flex_track_place="center" style_pad_gap="#space_xs">
              <event_cb trigger="clicked" callback="on_filament_unload"/>
              <lv_obj-bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
              <lv_obj-bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
              <icon src="arrow_up" size="sm" variant="primary"/>
              <text_body text="Unload"/>
            </lv_button>
          </lv_obj>
          <!-- Purge Button -->
          <lv_button name="btn_purge"
                     width="100%" height="#button_height" style_radius="#border_radius" style_border_width="0"
                     flex_flow="row" style_flex_main_place="center" style_flex_cross_place="center"
                     style_flex_track_place="center" style_pad_gap="#space_xs">
            <event_cb trigger="clicked" callback="on_filament_purge"/>
            <lv_obj-bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <lv_obj-bind_state_if_eq subject="filament_operation_in_progress" state="disabled" ref_value="1"/>
            <icon src="filament" size="sm" variant="primary"/>
            <text_body text="Purge"/>
          </lv_button>
        </lv_obj>
        <!-- Safety Warning (compact inline - shows when cold) -->
        <lv_obj name="safety_warning"
                width="100%" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_xs">
          <lv_obj-bind_flag_if_eq subject="filament_safety_warning_visible" flag="hidden" ref_value="0"/>
          <icon src="alert" size="sm" variant="warning"/>
          <text_small text="Heat to 170Â°C to load/unload"/>
        </lv_obj>
      </lv_obj>
    </lv_obj>
  </view>
</component>
