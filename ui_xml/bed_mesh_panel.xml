<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Bed Mesh Panel - Mainsail-inspired two-card layout -->
<!-- Left: 3D mesh visualization with touch drag rotation -->
<!-- Right: "Current Mesh" stats card + "Profiles" list card -->
<component>
  <!-- Component-local constants for mesh visualization colors and responsive sizing -->
  <consts>
    <!-- Mesh visualization gradient -->
    <color name="mesh_low" value="#88c0d0"/>
    <!-- nord8 - cold -->
    <color name="mesh_mid" value="#a3be8c"/>
    <!-- nord14 - neutral -->
    <color name="mesh_high" value="#bf616a"/>
    <!-- nord11 - hot -->

    <!-- Info column width per breakpoint -->
    <px name="bed_mesh_info_column_width_tiny" value="180"/>
    <px name="bed_mesh_info_column_width_small" value="280"/>
    <px name="bed_mesh_info_column_width_medium" value="280"/>
    <px name="bed_mesh_info_column_width_large" value="280"/>
  </consts>
  <view name="bed_mesh_panel"
        extends="lv_obj" width="#overlay_panel_width" height="100%" align="right_mid" style_bg_opa="255"
        style_bg_color="#card_bg" style_pad_all="0" style_border_width="0" scrollable="false" flex_flow="column">
    <!-- Header Bar with CALIBRATE action button -->
    <header_bar name="overlay_header"
                title="Bed Mesh" title_tag="Bed Mesh" action_button_text="Probe" action_button_height="#button_height"
                action_button_pad="#space_md" hide_action_button="false"
                action_button_callback="on_bed_mesh_calibrate_clicked"/>
    <!-- Content Area: Horizontal split (Left=Canvas, Right=Cards) -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_pad_all="#space_md" scrollable="false" flex_flow="row"
            style_pad_gap="#space_md">
      <!-- Left: 3D Mesh Canvas wrapper (fills remaining space) -->
      <lv_obj name="canvas_wrapper" height="100%" flex_grow="1" style_pad_all="0" scrollable="false">
        <bed_mesh name="bed_mesh_canvas" width="100%" height="100%" clickable="true" style_border_width="0"/>
        <!-- Empty state overlay - absolutely positioned centered over canvas -->
        <centered_column name="no_mesh_overlay" width="content" height="content" align="center">
          <bind_flag_if_eq subject="bed_mesh_available" flag="hidden" ref_value="1"/>
          <icon src="grid_off" size="lg" variant="muted"/>
          <text_muted text="No mesh loaded" translation_tag="No mesh loaded" style_pad_top="#space_md"/>
        </centered_column>
      </lv_obj>
      <!-- Right: Info column with two cards -->
      <lv_obj name="info_column"
              width="#bed_mesh_info_column_width" height="100%" flex_flow="column" style_pad_all="0"
              style_pad_gap="#space_md" scrollable="false">
        <!-- ============================================================ -->
        <!-- CURRENT MESH CARD -->
        <!-- ============================================================ -->
        <ui_card name="current_mesh_card"
                 width="100%" height="content" style_border_width="0" style_pad_all="0" flex_flow="column"
                 scrollable="false">
          <!-- Card Header -->
          <lv_obj width="100%"
                  height="content" flex_flow="row" style_flex_cross_place="center" style_pad_left="#space_md"
                  style_pad_right="#space_md" style_pad_top="#space_sm" style_pad_bottom="#space_sm"
                  style_pad_gap="#space_sm" scrollable="false">
            <icon src="info" size="sm" variant="success"/>
            <text_body text="Current Mesh" translation_tag="Current Mesh" flex_grow="1"/>
          </lv_obj>
          <!-- Divider -->
          <divider_horizontal/>
          <!-- Card Content -->
          <lv_obj width="100%"
                  height="content" flex_flow="column" style_pad_all="#space_md" style_pad_gap="#space_xs"
                  scrollable="false">
            <!-- Name row -->
            <lv_obj width="100%" flex_flow="row" style_pad_all="0" scrollable="false">
              <text_small text="Name" translation_tag="Name"/>
              <text_small name="mesh_name_value"
                          bind_text="bed_mesh_profile_name" flex_grow="1" style_text_align="right"
                          style_pad_left="#space_sm" style_text_color="#success"/>
            </lv_obj>
            <!-- Size row -->
            <lv_obj width="100%" flex_flow="row" style_pad_all="0" scrollable="false">
              <text_small text="Size" translation_tag="Size"/>
              <text_small name="mesh_size_value"
                          bind_text="bed_mesh_dimensions" flex_grow="1" style_text_align="right"
                          style_pad_left="#space_sm" style_text_color="#text"/>
            </lv_obj>
            <!-- Max row -->
            <lv_obj width="100%" flex_flow="row" style_pad_all="0" scrollable="false">
              <text_small name="mesh_max_label" bind_text="bed_mesh_max_label"/>
              <text_small name="mesh_max_value"
                          bind_text="bed_mesh_max_value" flex_grow="1" style_text_align="right"
                          style_pad_left="#space_sm" style_text_color="#text"/>
            </lv_obj>
            <!-- Min row -->
            <lv_obj width="100%" flex_flow="row" style_pad_all="0" scrollable="false">
              <text_small name="mesh_min_label" bind_text="bed_mesh_min_label"/>
              <text_small name="mesh_min_value"
                          bind_text="bed_mesh_min_value" flex_grow="1" style_text_align="right"
                          style_pad_left="#space_sm" style_text_color="#text"/>
            </lv_obj>
            <!-- Z Range row -->
            <lv_obj width="100%" flex_flow="row" style_pad_all="0" scrollable="false">
              <text_small text="Z Range" translation_tag="Z Range"/>
              <text_small name="mesh_range_value"
                          bind_text="bed_mesh_variance" flex_grow="1" style_text_align="right"
                          style_pad_left="#space_sm" style_text_color="#text"/>
            </lv_obj>
          </lv_obj>
        </ui_card>
        <!-- ============================================================ -->
        <!-- PROFILES CARD -->
        <!-- ============================================================ -->
        <ui_card name="profiles_card"
                 width="100%" flex_grow="1" style_border_width="0" style_pad_all="0" flex_flow="column"
                 scrollable="false">
          <!-- Card Header -->
          <lv_obj width="100%"
                  height="content" flex_flow="row" style_flex_cross_place="center" style_pad_left="#space_md"
                  style_pad_right="#space_md" style_pad_top="#space_sm" style_pad_bottom="#space_sm"
                  style_pad_gap="#space_sm" scrollable="false">
            <icon src="layers" size="sm" variant="success"/>
            <text_body text="Profiles" translation_tag="Profiles" flex_grow="1"/>
          </lv_obj>
          <!-- Divider -->
          <divider_horizontal/>
          <!-- Profiles List (scrollable) -->
          <lv_obj name="profiles_list"
                  width="100%" flex_grow="1" flex_flow="column" style_pad_all="#space_sm" style_pad_gap="#space_xs"
                  scrollable="true">
            <!-- Profile Row 0 -->
            <ui_card name="profile_row_0"
                     width="100%" height="44" flex_flow="row" style_flex_cross_place="center" style_border_width="0"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="0" style_pad_bottom="0"
                     style_pad_gap="#space_xs" clickable="true" scrollable="false">
              <bind_flag_if_lt subject="bed_mesh_profile_count" flag="hidden" ref_value="1"/>
              <event_cb trigger="clicked" callback="on_profile_0_clicked"/>
              <!-- Name -->
              <text_small name="profile_0_name"
                          bind_text="bed_mesh_profile_0_name" flex_grow="1" style_text_color="#text"/>
              <!-- Range -->
              <text_small name="profile_0_range"
                          width="50" bind_text="bed_mesh_profile_0_range" style_text_align="right"/>
              <!-- Rename icon (only when active) -->
              <icon name="profile_0_rename"
                    src="pencil" size="sm" color="#success" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_0_active" flag="hidden" ref_value="0"/>
                <event_cb trigger="clicked" callback="on_profile_0_rename"/>
              </icon>
              <!-- Load icon (only when NOT active) -->
              <icon name="profile_0_load"
                    src="arrow_up_circle" size="sm" variant="muted" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_0_active" flag="hidden" ref_value="1"/>
                <event_cb trigger="clicked" callback="on_profile_0_clicked"/>
              </icon>
              <!-- Delete icon (always visible) -->
              <icon name="profile_0_delete"
                    src="trash_can_outline" size="sm" variant="danger" clickable="true" style_pad_all="#space_xs">
                <event_cb trigger="clicked" callback="on_profile_0_delete"/>
              </icon>
            </ui_card>
            <!-- Profile Row 1 -->
            <ui_card name="profile_row_1"
                     width="100%" height="44" flex_flow="row" style_flex_cross_place="center" style_border_width="0"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="0" style_pad_bottom="0"
                     style_pad_gap="#space_xs" clickable="true" scrollable="false">
              <bind_flag_if_lt subject="bed_mesh_profile_count" flag="hidden" ref_value="2"/>
              <event_cb trigger="clicked" callback="on_profile_1_clicked"/>
              <text_small name="profile_1_name"
                          bind_text="bed_mesh_profile_1_name" flex_grow="1" style_text_color="#text"/>
              <text_small name="profile_1_range"
                          width="50" bind_text="bed_mesh_profile_1_range" style_text_align="right"/>
              <icon name="profile_1_rename"
                    src="pencil" size="sm" color="#success" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_1_active" flag="hidden" ref_value="0"/>
                <event_cb trigger="clicked" callback="on_profile_1_rename"/>
              </icon>
              <icon name="profile_1_load"
                    src="arrow_up_circle" size="sm" variant="muted" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_1_active" flag="hidden" ref_value="1"/>
                <event_cb trigger="clicked" callback="on_profile_1_clicked"/>
              </icon>
              <icon name="profile_1_delete"
                    src="trash_can_outline" size="sm" variant="danger" clickable="true" style_pad_all="#space_xs">
                <event_cb trigger="clicked" callback="on_profile_1_delete"/>
              </icon>
            </ui_card>
            <!-- Profile Row 2 -->
            <ui_card name="profile_row_2"
                     width="100%" height="44" flex_flow="row" style_flex_cross_place="center" style_border_width="0"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="0" style_pad_bottom="0"
                     style_pad_gap="#space_xs" clickable="true" scrollable="false">
              <bind_flag_if_lt subject="bed_mesh_profile_count" flag="hidden" ref_value="3"/>
              <event_cb trigger="clicked" callback="on_profile_2_clicked"/>
              <text_small name="profile_2_name"
                          bind_text="bed_mesh_profile_2_name" flex_grow="1" style_text_color="#text"/>
              <text_small name="profile_2_range"
                          width="50" bind_text="bed_mesh_profile_2_range" style_text_align="right"/>
              <icon name="profile_2_rename"
                    src="pencil" size="sm" color="#success" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_2_active" flag="hidden" ref_value="0"/>
                <event_cb trigger="clicked" callback="on_profile_2_rename"/>
              </icon>
              <icon name="profile_2_load"
                    src="arrow_up_circle" size="sm" variant="muted" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_2_active" flag="hidden" ref_value="1"/>
                <event_cb trigger="clicked" callback="on_profile_2_clicked"/>
              </icon>
              <icon name="profile_2_delete"
                    src="trash_can_outline" size="sm" variant="danger" clickable="true" style_pad_all="#space_xs">
                <event_cb trigger="clicked" callback="on_profile_2_delete"/>
              </icon>
            </ui_card>
            <!-- Profile Row 3 -->
            <ui_card name="profile_row_3"
                     width="100%" height="44" flex_flow="row" style_flex_cross_place="center" style_border_width="0"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="0" style_pad_bottom="0"
                     style_pad_gap="#space_xs" clickable="true" scrollable="false">
              <bind_flag_if_lt subject="bed_mesh_profile_count" flag="hidden" ref_value="4"/>
              <event_cb trigger="clicked" callback="on_profile_3_clicked"/>
              <text_small name="profile_3_name"
                          bind_text="bed_mesh_profile_3_name" flex_grow="1" style_text_color="#text"/>
              <text_small name="profile_3_range"
                          width="50" bind_text="bed_mesh_profile_3_range" style_text_align="right"/>
              <icon name="profile_3_rename"
                    src="pencil" size="sm" color="#success" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_3_active" flag="hidden" ref_value="0"/>
                <event_cb trigger="clicked" callback="on_profile_3_rename"/>
              </icon>
              <icon name="profile_3_load"
                    src="arrow_up_circle" size="sm" variant="muted" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_3_active" flag="hidden" ref_value="1"/>
                <event_cb trigger="clicked" callback="on_profile_3_clicked"/>
              </icon>
              <icon name="profile_3_delete"
                    src="trash_can_outline" size="sm" variant="danger" clickable="true" style_pad_all="#space_xs">
                <event_cb trigger="clicked" callback="on_profile_3_delete"/>
              </icon>
            </ui_card>
            <!-- Profile Row 4 -->
            <ui_card name="profile_row_4"
                     width="100%" height="44" flex_flow="row" style_flex_cross_place="center" style_border_width="0"
                     style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="0" style_pad_bottom="0"
                     style_pad_gap="#space_xs" clickable="true" scrollable="false">
              <bind_flag_if_lt subject="bed_mesh_profile_count" flag="hidden" ref_value="5"/>
              <event_cb trigger="clicked" callback="on_profile_4_clicked"/>
              <text_small name="profile_4_name"
                          bind_text="bed_mesh_profile_4_name" flex_grow="1" style_text_color="#text"/>
              <text_small name="profile_4_range"
                          width="50" bind_text="bed_mesh_profile_4_range" style_text_align="right"/>
              <icon name="profile_4_rename"
                    src="pencil" size="sm" color="#success" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_4_active" flag="hidden" ref_value="0"/>
                <event_cb trigger="clicked" callback="on_profile_4_rename"/>
              </icon>
              <icon name="profile_4_load"
                    src="arrow_up_circle" size="sm" variant="muted" clickable="true" style_pad_all="#space_xs">
                <bind_flag_if_eq subject="bed_mesh_profile_4_active" flag="hidden" ref_value="1"/>
                <event_cb trigger="clicked" callback="on_profile_4_clicked"/>
              </icon>
              <icon name="profile_4_delete"
                    src="trash_can_outline" size="sm" variant="danger" clickable="true" style_pad_all="#space_xs">
                <event_cb trigger="clicked" callback="on_profile_4_delete"/>
              </icon>
            </ui_card>
            <!-- Empty state message (shown when no profiles) -->
            <lv_obj name="no_profiles_message"
                    width="100%" height="content" style_pad_all="#space_md" scrollable="false">
              <bind_flag_if_gt subject="bed_mesh_profile_count" flag="hidden" ref_value="0"/>
              <text_small width="100%" text="No profiles available" translation_tag="No profiles available" style_text_align="center"/>
            </lv_obj>
          </lv_obj>
        </ui_card>
      </lv_obj>
    </lv_obj>
  </view>
</component>
