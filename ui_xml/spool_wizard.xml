<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Spool Wizard: 3-step overlay for creating new spools in Spoolman -->
<!-- Steps: 0=Select Vendor, 1=Select Filament, 2=Spool Details -->
<component>
  <view name="spool_wizard"
        extends="lv_obj" width="#overlay_panel_width" height="100%" align="right_mid" style_border_width="0"
        style_pad_all="0" style_bg_opa="255" style_bg_color="#card_bg" scrollable="false" flex_flow="column">

    <!-- ==================== HEADER ==================== -->
    <header_bar name="overlay_header" title="New Spool: Step 1 of 3" title_tag="New Spool"/>

    <!-- ==================== CONTENT AREA ==================== -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_pad_all="#space_lg" style_pad_gap="#space_md" scrollable="false"
            flex_flow="column">

      <!-- ==================== STEP 0: SELECT VENDOR ==================== -->
      <lv_obj name="step_vendor"
              width="100%" flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="#space_md"
              scrollable="false" hidden="true">
        <bind_flag_if_not_eq subject="spool_wizard_step" flag="hidden" ref_value="0"/>

        <!-- Search row: input + "+" button -->
        <lv_obj width="100%"
                height="content" flex_flow="row" style_pad_all="0" style_pad_gap="#space_sm"
                style_flex_cross_place="center" scrollable="false">
          <text_input name="vendor_search"
                      flex_grow="1" placeholder_text="Search vendors..." placeholder_tag="Search vendors...">
            <event_cb trigger="value_changed" callback="on_wizard_vendor_search_changed"/>
          </text_input>
          <ui_button name="add_vendor_btn" variant="secondary" text="+ New"
                     translation_tag="+ New" width="content">
            <event_cb trigger="clicked" callback="on_wizard_show_create_vendor_modal"/>
          </ui_button>
        </lv_obj>

        <!-- Vendor list (scrollable) -->
        <lv_obj name="vendor_list"
                width="100%" flex_grow="1" scrollable="true" flex_flow="column"
                style_pad_left="#space_xs" style_pad_right="#space_xs" style_pad_top="0" style_pad_bottom="0"
                style_pad_gap="#space_sm"/>

        <!-- Empty state for vendor list -->
        <centered_column name="vendor_empty_state" flex_grow="1" hidden="true">
          <bind_flag_if_not_eq subject="spool_wizard_vendor_count" flag="hidden" ref_value="0"/>
          <icon src="inbox_outline" size="xl" variant="secondary"/>
          <text_body text="No vendors found"
                     translation_tag="No vendors found" style_text_align="center" style_text_color="#text_muted"/>
        </centered_column>

        <!-- Loading state for vendor list -->
        <centered_column name="vendor_loading_state" flex_grow="1" hidden="true">
          <bind_flag_if_not_eq subject="spool_wizard_vendors_loading" flag="hidden" ref_value="1"/>
          <spinner size="lg"/>
          <text_small text="Loading vendors..." translation_tag="Loading vendors..." style_text_align="center"/>
        </centered_column>
      </lv_obj>

      <!-- ==================== STEP 1: SELECT FILAMENT ==================== -->
      <lv_obj name="step_filament"
              width="100%" flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="#space_xs"
              scrollable="false" hidden="true">
        <bind_flag_if_not_eq subject="spool_wizard_step" flag="hidden" ref_value="1"/>

        <!-- Instruction text -->
        <text_small text="Choose an existing filament, or tap + New to create one."
                    translation_tag="Choose an existing filament, or tap + New to create one."
                    style_text_color="#text_muted" width="100%"/>

        <!-- Selected vendor display + New button -->
        <lv_obj width="100%"
                height="content" flex_flow="row" style_pad_all="0" style_flex_cross_place="center"
                style_pad_gap="#space_sm" scrollable="false">
          <text_small text="Vendor:" translation_tag="Vendor:" style_text_color="#text_muted"/>
          <text_body name="selected_vendor_label" bind_text="wizard_selected_vendor_name" flex_grow="1"/>
          <ui_button name="add_filament_btn" variant="secondary" text="+ New"
                     translation_tag="+ New" width="content">
            <event_cb trigger="clicked" callback="on_wizard_show_create_filament_modal"/>
          </ui_button>
        </lv_obj>

        <!-- Filament list (scrollable) -->
        <lv_obj name="filament_list"
                width="100%" flex_grow="1" scrollable="true" flex_flow="column"
                style_pad_left="#space_xs" style_pad_right="#space_xs" style_pad_top="0" style_pad_bottom="0"
                style_pad_gap="#space_xs"/>

        <!-- Empty state for filament list -->
        <centered_column name="filament_empty_state" flex_grow="1" hidden="true">
          <bind_flag_if_not_eq subject="spool_wizard_filament_count" flag="hidden" ref_value="0"/>
          <icon src="inbox_outline" size="xl" variant="secondary"/>
          <text_body text="No filaments found"
                     translation_tag="No filaments found" style_text_align="center" style_text_color="#text_muted"/>
        </centered_column>

        <!-- Loading state for filament list -->
        <centered_column name="filament_loading_state" flex_grow="1" hidden="true">
          <bind_flag_if_not_eq subject="spool_wizard_filaments_loading" flag="hidden" ref_value="1"/>
          <spinner size="lg"/>
          <text_small text="Loading filaments..." translation_tag="Loading filaments..." style_text_align="center"/>
        </centered_column>

      </lv_obj>

      <!-- ==================== STEP 2: SPOOL DETAILS ==================== -->
      <lv_obj name="step_spool"
              width="100%" flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="#space_sm"
              scrollable="false" hidden="true">
        <bind_flag_if_not_eq subject="spool_wizard_step" flag="hidden" ref_value="2"/>

        <!-- Summary: color swatch left, vendor + filament right -->
        <ui_card name="summary_card"
                 width="100%" height="content" style_pad_all="#space_sm" flex_flow="row"
                 style_pad_gap="#space_sm" style_flex_cross_place="center">
          <lv_obj name="summary_color_swatch"
                  width="28" height="28" style_radius="14" style_bg_color="0x808080" style_bg_opa="255"
                  style_border_width="1" style_border_color="#border"/>
          <lv_obj height="content" flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="0"
                  scrollable="false">
            <text_small name="summary_vendor" bind_text="wizard_summary_vendor"/>
            <text_small name="summary_filament" bind_text="wizard_summary_filament" style_text_color="#text_muted"/>
          </lv_obj>
        </ui_card>

        <!-- Row 1: Remaining Weight + Price side by side -->
        <lv_obj width="100%"
                height="content" flex_flow="row" style_pad_all="0" style_pad_gap="#space_sm" scrollable="false">
          <lv_obj height="content"
                  flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="2" scrollable="false">
            <text_small text="Remaining Weight (g)" translation_tag="Remaining Weight (g)" style_text_color="#text_muted"/>
            <text_input name="remaining_weight" width="100%" placeholder_text="1000" keyboard_hint="numeric">
              <event_cb trigger="value_changed" callback="on_wizard_remaining_weight_changed"/>
            </text_input>
          </lv_obj>
          <lv_obj height="content"
                  flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="2" scrollable="false">
            <text_small text="Price" translation_tag="Price" style_text_color="#text_muted"/>
            <text_input name="spool_price"
                        width="100%" placeholder_text="25.00" placeholder_tag="25.00" keyboard_hint="numeric">
              <event_cb trigger="value_changed" callback="on_wizard_price_changed"/>
            </text_input>
          </lv_obj>
        </lv_obj>

        <!-- Row 2: Lot Number + Notes side by side -->
        <lv_obj width="100%"
                height="content" flex_flow="row" style_pad_all="0" style_pad_gap="#space_sm" scrollable="false">
          <lv_obj height="content"
                  flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="2" scrollable="false">
            <text_small text="Lot # (optional)" translation_tag="Lot # (optional)" style_text_color="#text_muted"/>
            <text_input name="spool_lot" width="100%" placeholder_text="LOT-2024-001" placeholder_tag="LOT-2024-001">
              <event_cb trigger="value_changed" callback="on_wizard_lot_changed"/>
            </text_input>
          </lv_obj>
          <lv_obj height="content"
                  flex_grow="1" flex_flow="column" style_pad_all="0" style_pad_gap="2" scrollable="false">
            <text_small text="Notes (optional)" translation_tag="Notes (optional)" style_text_color="#text_muted"/>
            <text_input name="spool_notes"
                        width="100%" placeholder_text="Any notes..." placeholder_tag="Any notes...">
              <event_cb trigger="value_changed" callback="on_wizard_notes_changed"/>
            </text_input>
          </lv_obj>
        </lv_obj>
      </lv_obj>

      <!-- ==================== CREATING STATE ==================== -->
      <centered_column name="creating_state" flex_grow="1" hidden="true">
        <bind_flag_if_not_eq subject="wizard_creating" flag="hidden" ref_value="1"/>
        <spinner size="lg"/>
        <text_body text="Creating spool..." translation_tag="Creating spool..." style_text_align="center"/>
      </centered_column>

    </lv_obj>

    <!-- ==================== FOOTER: NAVIGATION BUTTONS ==================== -->
    <lv_obj name="wizard_footer"
            width="100%" height="content" flex_flow="row" style_flex_main_place="space_between"
            style_flex_cross_place="center" style_pad_hor="#space_lg" style_pad_ver="#space_md" scrollable="false">

      <!-- Back button: hidden on step 0 -->
      <ui_button name="back_btn" variant="ghost" text="Back" translation_tag="Back" hidden="true">
        <bind_flag_if_eq subject="spool_wizard_step" flag="hidden" ref_value="0"/>
        <event_cb trigger="clicked" callback="on_wizard_back"/>
      </ui_button>

      <!-- Spacer to push Next/Create to the right when Back is hidden -->
      <lv_obj name="footer_spacer" width="0" height="1" flex_grow="1"/>

      <!-- Next button: visible on steps 0 and 1 -->
      <ui_button name="next_btn" variant="primary" text="Next" translation_tag="Next" hidden="true">
        <bind_flag_if_eq subject="spool_wizard_step" flag="hidden" ref_value="2"/>
        <bind_state_if_eq subject="spool_wizard_can_proceed" state="disabled" ref_value="0"/>
        <event_cb trigger="clicked" callback="on_wizard_next"/>
      </ui_button>

      <!-- Create button: visible on step 2 only -->
      <ui_button name="create_btn" variant="primary" text="Create Spool" translation_tag="Create Spool" hidden="true">
        <bind_flag_if_not_eq subject="spool_wizard_step" flag="hidden" ref_value="2"/>
        <bind_state_if_eq subject="spool_wizard_can_proceed" state="disabled" ref_value="0"/>
        <bind_state_if_eq subject="wizard_creating" state="disabled" ref_value="1"/>
        <event_cb trigger="clicked" callback="on_wizard_create"/>
      </ui_button>
    </lv_obj>
  </view>
</component>
