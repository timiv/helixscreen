<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Print File Detail View - Full overlay showing file details and print options -->
  <!-- Uses reactive subjects for file data (no API properties needed) -->
  <view name="detail_view_root"
        extends="lv_obj" width="#overlay_panel_width" height="100%" align="right_mid" style_bg_opa="255"
        style_bg_color="#card_bg" style_border_width="0" style_pad_all="0" style_pad_gap="0" flex_flow="column"
        clickable="true">
    <event_cb trigger="clicked" callback="on_print_select_detail_backdrop"/>
    <!-- HEADER BAR (full width at top) -->
    <header_bar name="detail_header"
                title="Print File" title_tag="Print File" back_button_callback="on_print_detail_back_clicked"/>
    <!-- CONTENT AREA (two columns) -->
    <lv_obj name="content_container"
            width="100%" flex_grow="1" style_pad_left="#space_lg" style_pad_right="#space_lg" style_pad_top="0"
            style_pad_bottom="#space_lg" flex_flow="row" style_pad_gap="#space_md" scrollable="false">

      <!-- ================================================================== -->
      <!-- LEFT SECTION: File card with reactive bindings (5/9 width)        -->
      <!-- NOTE: Can't reuse print_file_card here because it uses props ($) -->
      <!-- for static data, but detail view needs bindings (bind_*) for     -->
      <!-- reactive updates when user selects different files.              -->
      <!-- ================================================================== -->
      <ui_card name="detail_card"
               height="100%" flex_grow="5" style_radius="#border_radius" style_pad_all="0" style_clip_corner="true"
               style_margin_left="#space_sm">
        <!-- Pre-rendered gradient background (source updated by C++ on theme switch) -->
        <!-- Hidden in 3D mode (value=1) so 3D viewer has clean black background -->
        <lv_image name="gradient_bg" width="100%" height="100%" src="A:assets/images/gradient-panel-medium-dark.bin">
          <bind_flag_if_eq subject="detail_gcode_viewer_mode" flag="hidden" ref_value="1"/>
        </lv_image>
        <!-- 3D/2D G-code viewer (hidden in thumbnail mode=0) -->
        <gcode_viewer name="detail_gcode_viewer" width="100%" height="100%">
          <bind_flag_if_eq subject="detail_gcode_viewer_mode" flag="hidden" ref_value="0"/>
        </gcode_viewer>
        <!-- Thumbnail with reactive binding - hidden when viewer is active (mode > 0) -->
        <lv_image name="detail_thumbnail"
                  width="100%" height="100%" bind_src="selected_detail_thumbnail" align="center" inner_align="contain"
                  style_translate_y="#preview_offset_y">
          <bind_flag_if_gt subject="detail_gcode_viewer_mode" flag="hidden" ref_value="0"/>
        </lv_image>
        <!-- Rotate hint icon (shown in 3D mode only) -->
        <lv_label name="detail_rotate_hint"
                  text="#icon_rotate_3d" style_text_font="mdi_icons_24" style_text_color="#text_muted"
                  style_text_opa="180" align="top_right" style_translate_x="-12" style_translate_y="#space_md">
          <bind_flag_if_not_eq subject="detail_gcode_viewer_mode" flag="hidden" ref_value="1"/>
        </lv_label>
        <!-- Loading spinner overlay - shown while G-code is downloading/parsing -->
        <lv_obj name="detail_loading_overlay"
                width="100%" height="100%" align="center" style_bg_opa="120" style_bg_color="#000000"
                scrollable="false">
          <bind_flag_if_eq subject="detail_gcode_loading" flag="hidden" ref_value="0"/>
          <spinner size="lg" align="center"/>
        </lv_obj>
        <!-- No-thumbnail placeholder - shown when file has no real thumbnail -->
        <icon name="detail_no_thumbnail_icon"
              src="cube_outline" size="xl" variant="tertiary" align="center" style_translate_y="-20" hidden="true"/>
        <!-- Metadata clip container - clips top rounded corners of inner overlay -->
        <!-- Height sized for 2x3 metadata grid (filename + 3 rows of metadata) -->
        <lv_obj name="detail_metadata_clip"
                width="100%" height="#detail_metadata_clip_height" style_radius="0" style_pad_all="0" align="bottom_mid"
                scrollable="false">
          <!-- Inner overlay with rounded corners - slightly taller to hide top radius -->
          <lv_obj name="detail_metadata_overlay"
                  width="100%" height="#detail_metadata_overlay_height" style_bg_opa="160" style_radius="#border_radius"
                  style_pad_left="#space_sm" style_pad_right="#space_sm" style_pad_top="#space_sm"
                  style_pad_bottom="#space_sm" style_pad_gap="#space_xs" align="bottom_mid" flex_flow="column"
                  scrollable="false">
            <!-- Filename with reactive binding - scrolls if too long for single line -->
            <!-- Uses selected_display_filename (without .gcode extension) for cleaner UI -->
            <text_body name="detail_filename_label"
                       width="100%" height="content" bind_text="selected_display_filename" long_mode="scroll_circular"
                       style_pad_bottom="0" style_border_width="0"/>
            <!-- Metadata 2x2 grid - minimal gap from filename -->
            <lv_obj name="detail_metadata_grid"
                    width="100%" height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xxs"
                    scrollable="false">
              <!-- Row 1: Print time + Filament weight -->
              <lv_obj name="metadata_row_1"
                      width="100%" height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_xs"
                      scrollable="false">
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="clock" size="xs" variant="primary"/>
                  <text_small name="detail_time_label"
                              bind_text="selected_print_time" long_mode="dots" flex_grow="1" style_translate_y="2"/>
                </lv_obj>
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="weight" size="xs" variant="primary"/>
                  <text_small name="detail_filament_label"
                              bind_text="selected_filament_weight" long_mode="dots" flex_grow="1" style_translate_y="2"/>
                </lv_obj>
              </lv_obj>
              <!-- Row 2: Print height + Layer count -->
              <lv_obj name="metadata_row_2"
                      width="100%" height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_xs"
                      scrollable="false">
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="ruler" size="xs" variant="primary"/>
                  <text_small name="detail_height_label"
                              bind_text="selected_print_height" long_mode="dots" flex_grow="1" style_translate_y="2"/>
                </lv_obj>
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="layers" size="xs" variant="primary"/>
                  <text_small name="detail_layers_label"
                              bind_text="selected_layer_count" long_mode="dots" flex_grow="1" style_translate_y="2"/>
                </lv_obj>
              </lv_obj>
              <!-- Row 3: Layer height + Filament type (full width for truncation) -->
              <lv_obj name="metadata_row_3"
                      width="100%" height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_xs"
                      scrollable="false">
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="cube" size="xs" variant="primary"/>
                  <text_small name="detail_layer_height_label" bind_text="selected_layer_height" style_translate_y="2"/>
                </lv_obj>
                <lv_obj flex_grow="1"
                        style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs" style_flex_cross_place="center"
                        scrollable="false">
                  <icon src="filament" size="xs" variant="primary"/>
                  <text_small name="detail_filament_type_label"
                              flex_grow="1" long_mode="scroll_circular" bind_text="selected_filament_type"
                              style_translate_y="2"/>
                </lv_obj>
              </lv_obj>
            </lv_obj>
          </lv_obj>
        </lv_obj>
      </ui_card>

      <!-- ================================================================== -->
      <!-- RIGHT SECTION: Options and buttons (4/9 width)                    -->
      <!-- ================================================================== -->
      <lv_obj name="options_section"
              height="100%" flex_grow="4" style_pad_all="#space_sm" style_pad_gap="#space_lg" flex_flow="column">
        <!-- Print history status display (hidden by default) -->
        <lv_obj name="history_status_row"
                width="100%" height="content" flex_flow="row" style_pad_gap="#space_xs" style_flex_cross_place="center"
                style_pad_bottom="#space_sm" hidden="true">
          <icon name="history_status_icon" src="check" size="sm" variant="success"/>
          <text_body name="history_status_label" text=""/>
        </lv_obj>
        <!-- Unified pre-print steps section (hidden if empty via reactive binding) -->
        <lv_obj name="preprint_steps_section"
                width="100%" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xs">
          <bind_flag_if_eq subject="selected_preprint_steps_visible" flag="hidden" ref_value="0"/>
          <text_small text="PRE-PRINT STEPS" translation_tag="PRE-PRINT STEPS"/>
          <text_body name="preprint_steps_label"
                     bind_text="selected_preprint_steps" long_mode="wrap" style_text_color="#text"/>
        </lv_obj>

        <!-- Color requirements card (hidden by default, shown for multi-color prints) -->
        <ui_card name="color_requirements_card" width="100%" style_pad_all="0" flex_flow="column" hidden="true">
          <text_small text="COLORS REQUIRED" translation_tag="COLORS REQUIRED"/>
          <lv_obj name="color_swatches_row"
                  width="100%" height="32" style_pad_all="0" style_pad_gap="#space_xs" flex_flow="row"
                  style_pad_top="#space_xs" scrollable="false">
            <!-- Color swatches added dynamically in C++ -->
          </lv_obj>
        </ui_card>

        <!-- Wrapper: zero-gap so spacer doesn't add extra space from parent's pad_gap -->
        <lv_obj width="100%" flex_grow="1" style_pad_all="0" style_pad_gap="0" flex_flow="column">
          <!-- Options card -->
          <ui_card name="options_card" width="100%" style_pad_ver="0" style_pad_gap="#space_sm" flex_flow="column" style_bg_color="#elevated_bg">
            <bind_flag_if_eq subject="has_any_preprint_options" flag="hidden" ref_value="0"/>
            <!-- Pre-print G-code modification options -->
            <!-- Visibility: can_show_* = helix_plugin_installed AND printer_has_* -->
            <!-- Toggle rows: label on left, switch on right -->
            <lv_obj name="bed_mesh_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="can_show_bed_mesh" flag="hidden" ref_value="0"/>
              <text_body text="Auto Bed Mesh" translation_tag="Auto Bed Mesh"/>
              <ui_switch name="bed_mesh_checkbox" size="small">
                <bind_state_if_eq subject="preprint_bed_mesh" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_bed_mesh_toggled"/>
              </ui_switch>
            </lv_obj>
            <lv_obj name="qgl_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="can_show_qgl" flag="hidden" ref_value="0"/>
              <text_body text="Quad Gantry Level" translation_tag="Quad Gantry Level"/>
              <ui_switch name="qgl_checkbox" size="small">
                <bind_state_if_eq subject="preprint_qgl" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_qgl_toggled"/>
              </ui_switch>
            </lv_obj>
            <lv_obj name="z_tilt_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="can_show_z_tilt" flag="hidden" ref_value="0"/>
              <text_body text="Z-Tilt Adjust" translation_tag="Z-Tilt Adjust"/>
              <ui_switch name="z_tilt_checkbox" size="small">
                <bind_state_if_eq subject="preprint_z_tilt" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_z_tilt_toggled"/>
              </ui_switch>
            </lv_obj>
            <lv_obj name="nozzle_clean_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="can_show_nozzle_clean" flag="hidden" ref_value="0"/>
              <text_body text="Clean Nozzle" translation_tag="Clean Nozzle"/>
              <ui_switch name="nozzle_clean_checkbox" size="small">
                <bind_state_if_eq subject="preprint_nozzle_clean" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_nozzle_clean_toggled"/>
              </ui_switch>
            </lv_obj>
            <lv_obj name="purge_line_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="can_show_purge_line" flag="hidden" ref_value="0"/>
              <text_body text="Nozzle Priming" translation_tag="Nozzle Priming"/>
              <ui_switch name="purge_line_checkbox" size="small">
                <bind_state_if_eq subject="preprint_purge_line" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_purge_line_toggled"/>
              </ui_switch>
            </lv_obj>
            <!-- Recording options (visibility controlled by plugin availability) -->
            <lv_obj name="timelapse_row"
                    width="100%" flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                    style_pad_ver="#space_xs">
              <bind_flag_if_eq subject="printer_has_timelapse" flag="hidden" ref_value="0"/>
              <text_body text="Record Timelapse" translation_tag="Record Timelapse"/>
              <ui_switch name="timelapse_checkbox" size="small">
                <bind_state_if_eq subject="preprint_timelapse" state="checked" ref_value="1"/>
                <event_cb trigger="value_changed" callback="on_preprint_timelapse_toggled"/>
              </ui_switch>
            </lv_obj>
          </ui_card>

          <!-- Spacer pushes buttons to bottom when options card is hidden -->
          <lv_obj flex_grow="1"/>

          <!-- Button row -->
          <lv_obj name="button_row"
                  width="100%" height="content" style_pad_all="0" style_pad_gap="#button_padding" flex_flow="row">
          <!-- Delete button -->
          <ui_button name="delete_button"
                     height="#button_height_lg" text="Delete" translation_tag="Delete" variant="danger" flex_grow="1" icon="trash_can_outline">
            <event_cb trigger="clicked" callback="on_print_select_delete_button"/>
          </ui_button>
          <!-- Print button - primary action styling (disabled when print in progress) -->
          <ui_button name="print_button" height="#button_height_lg" text="Print" translation_tag="Print" flex_grow="1" icon="print">
            <event_cb trigger="clicked" callback="on_print_select_print_button"/>
            <bind_state_if_eq subject="print_select_can_print" state="disabled" ref_value="0"/>
          </ui_button>
        </lv_obj>
        </lv_obj>
      </lv_obj>
    </lv_obj>
  </view>
</component>
