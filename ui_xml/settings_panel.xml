<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Settings Panel - Enhanced Scrolling List Design -->
<!-- Comprehensive settings organized in sections with icons: Appearance, Printer, Notifications, System, About -->
<!-- All styling controlled via XML - C++ only updates subjects and handles callbacks -->
<component>
  <view name="settings_panel"
        extends="lv_obj" width="100%" height="100%" style_bg_opa="0" style_border_width="0" style_pad_all="0"
        style_pad_gap="0" flex_flow="column" scrollable="true" style_bg_color="#screen_bg">
    <!-- ================================================================== -->
    <!-- APPEARANCE SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="APPEARANCE" title_tag="APPEARANCE" icon="light"/>
    <!-- Language Dropdown -->
    <setting_dropdown_row name="row_language"
                          label="Language" label_tag="Language" icon="translate" description="Choose display language"
                          description_tag="Choose display language" callback="on_language_changed"/>
    <!-- Animations Toggle -->
    <setting_toggle_row name="row_animations"
                        label="Animations" label_tag="Animations" icon="animation"
                        description="Enable UI motion effects" description_tag="Enable UI motion effects"
                        callback="on_animations_changed"/>
    <!-- 3D Preview Toggle -->
    <setting_toggle_row name="row_gcode_3d"
                        label="3D Preview" label_tag="3D Preview" icon="rotate_3d"
                        description="Interactive 3D G-code during prints"
                        description_tag="Interactive 3D G-code during prints" callback="on_gcode_3d_changed"/>
    <!-- Display Settings (opens overlay for brightness + sleep timeout; hidden on Android) -->
    <lv_obj name="container_display_settings" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="show_backlight_settings" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_display_settings"
                          label="Display Settings" label_tag="Display Settings" icon="light"
                          description="Theme, brightness, and sleep settings"
                          description_tag="Theme, brightness, and sleep settings" callback="on_display_settings_clicked"/>
    </lv_obj>
    <!-- Panel Widgets (toggle and reorder status widgets on the home panel) -->
    <setting_action_row name="row_panel_widgets"
                        label="Home Widgets" label_tag="Home Widgets" icon="view_grid"
                        description="Toggle and reorder status widgets"
                        description_tag="Toggle and reorder status widgets" callback="on_panel_widgets_clicked"/>
    <!-- ================================================================== -->
    <!-- PRINTER SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="PRINTER" title_tag="PRINTER" icon="printer_3d"/>
    <!-- Filament Sensors (hidden if no sensors detected) -->
    <lv_obj name="container_filament_sensors" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="filament_sensor_count" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_filament_sensors"
                          label="Filament Sensors" label_tag="Filament Sensors" icon="filament"
                          description="Configure filament detection sensors"
                          description_tag="Configure filament detection sensors" callback="on_filament_sensors_clicked"/>
    </lv_obj>
    <!-- AMS Management (hidden if no AMS detected) -->
    <lv_obj name="container_ams_settings" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="ams_slot_count" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_ams_settings"
                          label="AMS Management" label_tag="AMS Management" icon="filament"
                          description="Quick actions, calibration, speed"
                          description_tag="Quick actions, calibration, speed" callback="on_ams_settings_clicked"/>
    </lv_obj>
    <!-- Spoolman Settings (hidden if Spoolman not available) -->
    <lv_obj name="container_spoolman_settings" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="printer_has_spoolman" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_spoolman_settings"
                          label="Spoolman" label_tag="Spoolman" icon="database" description="Weight sync settings"
                          description_tag="Weight sync settings" callback="on_spoolman_settings_clicked"/>
    </lv_obj>
    <!-- LED Light Settings (hidden if no LED capability) -->
    <lv_obj name="container_led_light"
            width="100%" style_pad_all="0" style_layout="flex" style_flex_flow="column" scrollable="false">
      <bind_flag_if_eq subject="printer_has_led" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_led_settings"
                          label="LED Settings" label_tag="LED Settings" icon="tune"
                          description="Startup, auto-control, and macro devices"
                          description_tag="Startup, auto-control, and macro devices" callback="on_led_settings_clicked"/>
    </lv_obj>
    <!-- Firmware Retraction Settings (hidden if no firmware_retraction capability) -->
    <lv_obj name="container_firmware_retraction" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="printer_has_firmware_retraction" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_firmware_retraction"
                          label="Retraction Settings" label_tag="Retraction Settings" icon="arrow_up_right"
                          description="Configure G10/G11 firmware retraction"
                          description_tag="Configure G10/G11 firmware retraction" callback="on_retraction_row_clicked"/>
    </lv_obj>
    <!-- Macro Buttons (opens overlay for configuring quick buttons and standard macros) -->
    <setting_action_row name="row_macro_buttons"
                        label="Macro Buttons" label_tag="Macro Buttons" icon="script_text"
                        description="Configure quick buttons and standard macros"
                        description_tag="Configure quick buttons and standard macros"
                        callback="on_macro_buttons_clicked"/>
    <!-- ================================================================== -->
    <!-- NOTIFICATIONS SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="NOTIFICATIONS" title_tag="NOTIFICATIONS" icon="notifications"/>
    <!-- Sound Settings (opens overlay for volume, themes, UI sounds) -->
    <lv_obj name="container_sound_settings" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="printer_has_speaker" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_sound_settings"
                          label="Sound Settings" label_tag="Sound Settings" icon="notifications"
                          description="Volume, themes, and UI sounds" description_tag="Volume, themes, and UI sounds"
                          callback="on_sound_settings_clicked"/>
    </lv_obj>
    <!-- Completion Alert Dropdown (Off/Notification/Alert) -->
    <setting_dropdown_row name="row_completion_alert"
                          label="Print Completion Alert" label_tag="Print Completion Alert" icon="notifications"
                          description="Notify when print finishes" description_tag="Notify when print finishes"
                          options="Off&#10;Notification&#10;Alert" callback="on_completion_alert_changed"/>
    <!-- ================================================================== -->
    <!-- MOTION SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="MOTION" title_tag="MOTION" icon="speed"/>
    <!-- Z Movement Style Override (Auto / Bed Moves / Nozzle Moves) -->
    <setting_dropdown_row name="row_z_movement_style"
                          label="Z Movement" label_tag="Z Movement" icon="arrow_up_down"
                          description="How Z-axis movement is displayed"
                          description_tag="How Z-axis movement is displayed"
                          options="Auto&#10;Bed Moves&#10;Nozzle Moves" callback="on_z_movement_style_changed"/>
    <!-- Machine Limits -->
    <setting_action_row name="row_machine_limits"
                        label="Machine Limits" label_tag="Machine Limits" icon="dashboard"
                        description="Velocity and acceleration limits"
                        description_tag="Velocity and acceleration limits" callback="on_machine_limits_clicked"/>
    <!-- E-Stop Confirmation Toggle -->
    <setting_toggle_row name="row_estop_confirm"
                        label="E-Stop Confirmation" label_tag="E-Stop Confirmation" icon="alert_octagon"
                        description="Require confirmation before emergency stop"
                        description_tag="Require confirmation before emergency stop" callback="on_estop_confirm_changed"/>
    <!-- Cancel Escalation Toggle -->
    <setting_toggle_row name="row_cancel_escalation"
                        label="Cancel Escalation" label_tag="Cancel Escalation" icon="alert_octagon"
                        description="Escalate to emergency stop if cancel doesn't respond"
                        description_tag="Escalate to emergency stop if cancel doesn't respond"
                        subject="settings_cancel_escalation_enabled" callback="on_cancel_escalation_changed"/>
    <!-- Cancel Escalation Timeout (visible only when escalation enabled) -->
    <lv_obj name="container_cancel_escalation_timeout" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="settings_cancel_escalation_enabled" flag="hidden" ref_value="0"/>
      <setting_dropdown_row name="row_cancel_escalation_timeout"
                            label="Escalation Timeout" label_tag="Escalation Timeout" icon="clock"
                            description="Time to wait before escalating to emergency stop"
                            description_tag="Time to wait before escalating to emergency stop"
                            options="15 seconds&#10;30 seconds&#10;60 seconds&#10;120 seconds"
                            bind_selected="settings_cancel_escalation_timeout"
                            callback="on_cancel_escalation_timeout_changed"/>
    </lv_obj>
    <!-- ================================================================== -->
    <!-- SYSTEM SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="SYSTEM" title_tag="SYSTEM" icon="sysinfo"/>
    <!-- Network Settings (hidden on Android where OS manages WiFi) -->
    <lv_obj name="container_network_settings" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="show_network_settings" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_network"
                          label="Network Settings" label_tag="Network Settings" icon="wifi"
                          description="WiFi and Ethernet configuration"
                          description_tag="WiFi and Ethernet configuration" callback="on_network_clicked"/>
    </lv_obj>
    <!-- Printer Host (clickable - opens change host modal) -->
    <setting_action_row name="row_printer_host"
                        label="Host" label_tag="Host" icon="lan" callback="on_change_host_clicked"/>
    <!-- Touch Calibration (hidden on non-touch displays unless test mode) -->
    <!-- Description is bound to touch_cal_status subject in C++ setup() -->
    <lv_obj name="container_touch_calibration" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="show_touch_calibration" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_touch_calibration"
                          label="Touch Calibration" label_tag="Touch Calibration" icon="cursor_move" description=""
                          callback="on_touch_calibration_clicked"/>
    </lv_obj>
    <!-- Hardware Issues (hidden when no issues) -->
    <lv_obj name="container_hardware_health" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="hardware_has_issues" flag="hidden" ref_value="0"/>
      <!-- Label bound to hardware_issues_label subject in C++ for reactive updates -->
      <setting_action_row name="row_hardware_health"
                          label="Hardware Issues" label_tag="Hardware Issues" icon="alert"
                          description="Review detected hardware validation issues"
                          description_tag="Review detected hardware validation issues"
                          callback="on_hardware_health_clicked"/>
    </lv_obj>
    <!-- Plugins (gated by beta_features config flag) -->
    <beta_feature>
      <setting_action_row name="row_plugins"
                          label="Plugins" label_tag="Plugins" icon="puzzle_outline"
                          description="View installed plugins and status"
                          description_tag="View installed plugins and status" callback="on_plugins_clicked"/>
    </beta_feature>
    <!-- Telemetry -->
    <setting_toggle_row name="row_telemetry"
                        label="Share Usage Data" label_tag="Share Usage Data" icon="chart_line"
                        description="Anonymous data to help improve HelixScreen"
                        description_tag="Anonymous data to help improve HelixScreen" callback="on_telemetry_changed"/>
    <setting_action_row name="row_telemetry_view_data"
                        label="View Telemetry Data" label_tag="View Telemetry Data" icon="list"
                        description="See exactly what data will be sent"
                        description_tag="See exactly what data will be sent" callback="on_telemetry_view_data">
      <bind_flag_if_eq subject="settings_telemetry_enabled" flag="hidden" ref_value="0"/>
    </setting_action_row>
    <!-- Restart HelixScreen -->
    <setting_action_row name="row_restart_helix"
                        label="Restart HelixScreen" label_tag="Restart HelixScreen" icon="restart"
                        description="Restart the display application" description_tag="Restart the display application"
                        callback="on_restart_helix_settings_clicked"/>
    <!-- Factory Reset -->
    <setting_action_row name="row_factory_reset"
                        label="Factory Reset" label_tag="Factory Reset" icon="refresh"
                        description="Reset all settings and restart wizard"
                        description_tag="Reset all settings and restart wizard" callback="on_factory_reset_clicked"/>
    <!-- Install Update (visible only when update available) -->
    <lv_obj name="container_install_update" width="100%" style_pad_all="0">
      <bind_flag_if_eq subject="show_update_settings" flag="hidden" ref_value="0"/>
      <bind_flag_if_not_eq subject="update_status" flag="hidden" ref_value="2"/>
      <setting_action_row name="row_install_update"
                          label="Install Update" label_tag="Install Update" icon="download" description=""
                          description_tag="" callback="on_install_update_clicked"/>
    </lv_obj>
    <!-- ================================================================== -->
    <!-- HELP & SUPPORT SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="HELP &amp; SUPPORT" title_tag="HELP &amp; SUPPORT" icon="help"/>
    <setting_action_row name="row_debug_bundle"
                        label="Upload Debug Bundle" label_tag="Upload Debug Bundle" icon="bug"
                        description="Collect logs and system info for support"
                        description_tag="Collect logs and system info for support" callback="on_debug_bundle_clicked"/>
    <setting_action_row name="row_discord"
                        label="Discord Community" label_tag="Discord Community" icon="message"
                        description="Get help and share feedback" description_tag="Get help and share feedback"
                        callback="on_discord_clicked"/>
    <setting_action_row name="row_docs"
                        label="Documentation" label_tag="Documentation" icon="book" description="Guides and reference"
                        description_tag="Guides and reference" callback="on_docs_clicked"/>
    <!-- ================================================================== -->
    <!-- ABOUT SECTION -->
    <!-- ================================================================== -->
    <setting_section_header title="ABOUT" title_tag="ABOUT" icon="info"/>
    <!-- Printer Name -->
    <setting_info_row name="row_printer" label="Printer Name" label_tag="Printer Name" icon="printer_3d">
      <text_muted name="value" bind_text="printer_value"/>
    </setting_info_row>
    <!-- Current Version - ui_button for native press feedback (7-tap secret to toggle beta features) -->
    <ui_button name="row_version" width="100%" height="content" variant="ghost" style_radius="0" style_pad_all="0">
      <lv_obj width="100%"
              height="content" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
              style_pad_left="#space_lg" style_pad_right="#space_lg" style_pad_top="#space_md"
              style_pad_bottom="#space_md" style_pad_gap="#space_sm" scrollable="false" clickable="false"
              event_bubble="true">
        <icon name="row_icon" src="info" size="sm" variant="secondary" clickable="false" event_bubble="true"/>
        <text_body name="label"
                   text="Current Version" translation_tag="Current Version" style_text_color="#text" flex_grow="1"
                   clickable="false" event_bubble="true"/>
        <text_muted name="value" bind_text="version_value" clickable="false" event_bubble="true"/>
      </lv_obj>
      <event_cb trigger="clicked" callback="on_version_clicked"/>
    </ui_button>
    <!-- Update Channel (gated by beta_features) -->
    <lv_obj name="container_update_channel" width="100%" style_pad_all="0">
      <bind_flag_if_eq subject="show_beta_features" flag="hidden" ref_value="0"/>
      <setting_dropdown_row name="row_update_channel"
                            label="Update Channel" label_tag="Update Channel" icon="swap_vertical"
                            options="Stable&#10;Beta&#10;Dev" bind_selected="update_channel"
                            callback="on_update_channel_changed"/>
    </lv_obj>
    <!-- Check for Updates (reactive description shows available version; hidden on Android) -->
    <lv_obj name="container_check_updates" width="100%" style_pad_all="0" scrollable="false">
      <bind_flag_if_eq subject="show_update_settings" flag="hidden" ref_value="0"/>
      <setting_action_row name="row_check_updates"
                          label="Check for Updates" label_tag="Check for Updates" icon="refresh"
                          bind_description="update_version_text" callback="on_check_updates_clicked"/>
    </lv_obj>
    <!-- Klipper Version -->
    <setting_info_row name="row_klipper" label="Klipper" label_tag="Klipper" icon="toy_brick_outline">
      <text_muted name="value" text="—"/>
    </setting_info_row>
    <!-- Moonraker Version -->
    <setting_info_row name="row_moonraker" label="Moonraker" label_tag="Moonraker" icon="toy_brick_outline">
      <text_muted name="value" text="—"/>
    </setting_info_row>
    <!-- OS Version -->
    <setting_info_row name="row_os" label="OS" label_tag="OS" icon="console">
      <text_muted name="value" text="—"/>
    </setting_info_row>
    <!-- Total Print Hours (opens history dashboard) -->
    <setting_action_row name="row_print_hours"
                        label="Print Hours" label_tag="Print Hours" icon="clock" bind_description="print_hours_value"
                        callback="on_print_hours_clicked"/>
    <!-- Bottom padding for scroll -->
    <lv_obj width="100%" height="#space_lg" scrollable="false"/>
  </view>
</component>
