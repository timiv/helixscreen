<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Print History Dashboard Panel -->
<!-- Overlay panel showing aggregated print statistics with time filtering -->
<!-- Entry point: Advanced Panel → Print History action row -->
<!-- Navigation: Back → Advanced Panel, View Full History → History List Panel -->
<component>
  <consts>
    <!-- Layout dimensions for side-by-side stats + chart -->
    <percentage name="stats_section_width" value="55%"/>
    <percentage name="chart_section_width" value="43%"/>
  </consts>
  <!-- Styles for reactive filter button state binding (L040: two bind_styles pattern) -->
  <styles>
    <style name="filter_btn_selected" bg_color="#primary" bg_opa="255"/>
    <style name="filter_btn_unselected" bg_color="#primary" bg_opa="40"/>
  </styles>
  <view name="history_dashboard_panel" extends="overlay_panel" title="Print History">
    <!-- Content Area - scrollable to fit all content on small screens -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_bg_opa="0" style_pad_all="#space_lg" style_border_width="0"
            scrollable="true" scroll_dir="ver" flex_flow="column">
      <!-- Time Filter Segmented Buttons (equal width via flex_grow) -->
      <lv_obj width="100%"
              height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" style_pad_bottom="#space_md"
              flex_flow="row" style_pad_gap="#space_xs" scrollable="false">
        <ui_button name="filter_day" text="Day" flex_grow="1">
          <bind_style name="filter_btn_selected" subject="history_filter_day_active" ref_value="1"/>
          <bind_style name="filter_btn_unselected" subject="history_filter_day_active" ref_value="0"/>
          <event_cb trigger="clicked" callback="history_filter_day_clicked"/>
        </ui_button>
        <ui_button name="filter_week" text="Week" flex_grow="1">
          <bind_style name="filter_btn_selected" subject="history_filter_week_active" ref_value="1"/>
          <bind_style name="filter_btn_unselected" subject="history_filter_week_active" ref_value="0"/>
          <event_cb trigger="clicked" callback="history_filter_week_clicked"/>
        </ui_button>
        <ui_button name="filter_month" text="Month" flex_grow="1">
          <bind_style name="filter_btn_selected" subject="history_filter_month_active" ref_value="1"/>
          <bind_style name="filter_btn_unselected" subject="history_filter_month_active" ref_value="0"/>
          <event_cb trigger="clicked" callback="history_filter_month_clicked"/>
        </ui_button>
        <ui_button name="filter_year" text="Year" flex_grow="1">
          <bind_style name="filter_btn_selected" subject="history_filter_year_active" ref_value="1"/>
          <bind_style name="filter_btn_unselected" subject="history_filter_year_active" ref_value="0"/>
          <event_cb trigger="clicked" callback="history_filter_year_clicked"/>
        </ui_button>
        <ui_button name="filter_all" text="All" flex_grow="1">
          <bind_style name="filter_btn_selected" subject="history_filter_all_active" ref_value="1"/>
          <bind_style name="filter_btn_unselected" subject="history_filter_all_active" ref_value="0"/>
          <event_cb trigger="clicked" callback="history_filter_all_clicked"/>
        </ui_button>
      </lv_obj>
      <!-- Top Row: Stats (left) + Filament Chart (right) - hidden when no jobs -->
      <lv_obj name="top_row"
              width="100%" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" flex_flow="row"
              style_flex_main_place="space_between" style_pad_gap="#space_sm" scrollable="false">
        <bind_flag_if_eq subject="history_has_jobs" flag="hidden" ref_value="0"/>
        <!-- Left: Stats Grid (2x2) -->
        <lv_obj name="stats_grid"
                width="#stats_section_width" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0"
                flex_flow="row_wrap" style_flex_main_place="space_between" style_flex_cross_place="start"
                style_flex_track_place="start" style_pad_gap="#space_xs" scrollable="false">
          <!-- Row 1: Total Prints, Success Rate -->
          <ui_card name="card_total_prints"
                   width="48%" height="content" style_radius="#border_radius" style_pad_all="#space_xs"
                   flex_flow="column" style_flex_cross_place="start">
            <text_small text="Total Prints"/>
            <text_heading name="stat_total_prints" text="0" bind_text="stat_total_prints"/>
          </ui_card>
          <ui_card name="card_success_rate"
                   width="48%" height="content" style_radius="#border_radius" style_pad_all="#space_xs"
                   flex_flow="column" style_flex_cross_place="start">
            <text_small text="Success Rate"/>
            <text_heading name="stat_success_rate" text="0%" style_text_color="#success" bind_text="stat_success_rate"/>
          </ui_card>
          <!-- Row 2: Print Time, Filament Used -->
          <ui_card name="card_print_time"
                   width="48%" height="content" style_radius="#border_radius" style_pad_all="#space_xs"
                   flex_flow="column" style_flex_cross_place="start">
            <text_small text="Print Time"/>
            <text_heading name="stat_print_time" text="0h" bind_text="stat_print_time"/>
          </ui_card>
          <ui_card name="card_filament"
                   width="48%" height="content" style_radius="#border_radius" style_pad_all="#space_xs"
                   flex_flow="column" style_flex_cross_place="start">
            <text_small text="Filament Used"/>
            <text_heading name="stat_filament" text="0m" bind_text="stat_filament"/>
          </ui_card>
        </lv_obj>
        <!-- Right: Filament by Type Chart with Labels -->
        <ui_card name="card_filament_chart"
                 width="#chart_section_width" height="content" style_radius="#border_radius" style_pad_all="#space_sm"
                 flex_flow="column" style_pad_gap="#space_xs">
          <text_xs text="Filament by Type"/>
          <!-- Chart container for horizontal bars -->
          <lv_obj name="filament_chart_container"
                  width="100%" height="content" style_min_height="80" style_bg_opa="0" style_border_width="0"
                  style_pad_all="0" flex_flow="column" style_pad_gap="#space_xxs" scrollable="false">
            <!-- Filament rows will be populated by C++ - each row has label + bar -->
          </lv_obj>
        </ui_card>
      </lv_obj>
      <!-- Prints Trend Sparkline (full width, below stats and chart) - hidden when no jobs -->
      <ui_card name="card_prints_trend"
               width="100%" height="content" style_radius="#border_radius" style_pad_all="#space_sm"
               style_margin_top="#space_sm" flex_flow="column" style_pad_gap="#space_xs">
        <bind_flag_if_eq subject="history_has_jobs" flag="hidden" ref_value="0"/>
        <lv_obj width="100%"
                height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" flex_flow="row"
                style_flex_main_place="space_between" style_flex_cross_place="center" scrollable="false">
          <text_muted text="Prints Trend"/>
          <text_small name="trend_period" text="Last 7 days" bind_text="trend_period"/>
        </lv_obj>
        <!-- Chart container - will be populated by C++ -->
        <lv_obj name="trend_chart_container"
                width="100%" height="content" style_min_height="50" style_bg_opa="0" style_border_width="0"
                style_pad_all="0" scrollable="false"/>
      </ui_card>
      <!-- Empty State (shown when no history) - centered in available space -->
      <centered_column name="empty_state" flex_grow="1" style_pad_all="#space_xl" hidden="true">
        <bind_flag_if_not_eq subject="history_has_jobs" flag="hidden" ref_value="0"/>
        <icon src="clock" size="xl" variant="secondary"/>
        <text_muted width="100%" text="No print history yet" style_text_align="center"/>
        <text_small width="100%" text="Your completed prints will appear here" style_text_align="center"/>
      </centered_column>
      <!-- Flex shim to push button to bottom (hidden when empty state is shown) -->
      <lv_obj name="flex_shim"
              width="100%" style_bg_opa="0" style_border_width="0" style_pad_all="0" flex_grow="1" scrollable="false">
        <bind_flag_if_eq subject="history_has_jobs" flag="hidden" ref_value="0"/>
      </lv_obj>
      <!-- View Full History Button (at bottom) -->
      <ui_button name="btn_view_history"
                 width="100%" icon="list" text="View Full History">
        <event_cb trigger="clicked" callback="history_view_full_clicked"/>
      </ui_button>
    </lv_obj>
    <!-- End overlay_content -->
  </view>
</component>
