<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Styles for Z-offset step amount radio buttons (L040: TWO bind_styles per button) -->
  <styles>
    <style name="z_step_selected" bg_color="#primary" bg_opa="255"/>
    <style name="z_step_unselected" bg_color="#primary" bg_opa="40"/>
  </styles>
  <!-- Print Tuning Panel: Speed and Flow adjustment during active print -->
  <view name="print_tune_panel" extends="overlay_panel" title="Print Tuning" title_tag="Print Tuning">
    <!-- Content Area -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_pad_left="#space_lg" style_pad_right="#space_lg" style_pad_bottom="#space_lg" style_pad_top="0" flex_flow="column"
            style_flex_main_place="start" style_pad_gap="#space_md">
      <!-- Speed + Flow Row (side by side) -->
      <lv_obj name="speed_flow_row"
              width="100%" height="content" style_pad_all="0" scrollable="false" flex_flow="row"
              style_pad_gap="#space_lg" flag_overflow_visible="true">
        <!-- Speed Control (left) -->
        <lv_obj name="speed_section"
                height="content" flex_grow="1" style_pad_all="0" flex_flow="column" style_pad_gap="#space_sm"
                flag_overflow_visible="true" scrollable="false">
          <lv_obj width="100%" height="content" style_pad_all="0" scrollable="false" flex_flow="row"
                  style_flex_cross_place="center" style_pad_gap="#space_sm">
            <text_small text="Print Speed" translation_tag="Print Speed"/>
            <text_heading name="speed_display" bind_text="tune_speed_display"/>
          </lv_obj>
          <lv_slider name="speed_slider"
                     width="100%" height="#space_lg" min_value="50" max_value="200" value="100"
                     style_bg_color="#elevated_bg" style_radius="#space_md">
            <event_cb trigger="value_changed" callback="on_tune_speed_display"/>
            <event_cb trigger="released" callback="on_tune_speed_send"/>
          </lv_slider>
          <text_small text="Movement speed" translation_tag="Movement speed"/>
        </lv_obj>
        <!-- Flow Control (right) -->
        <lv_obj name="flow_section"
                height="content" flex_grow="1" style_pad_all="0" flex_flow="column" style_pad_gap="#space_sm"
                flag_overflow_visible="true" scrollable="false">
          <lv_obj width="100%" height="content" style_pad_all="0" scrollable="false" flex_flow="row"
                  style_flex_cross_place="center" style_pad_gap="#space_sm">
            <text_small text="Flow Rate" translation_tag="Flow Rate"/>
            <text_heading name="flow_display" bind_text="tune_flow_display"/>
          </lv_obj>
          <lv_slider name="flow_slider"
                     width="100%" height="#space_lg" min_value="75" max_value="125" value="100"
                     style_bg_color="#elevated_bg" style_radius="#space_md">
            <event_cb trigger="value_changed" callback="on_tune_flow_display"/>
            <event_cb trigger="released" callback="on_tune_flow_send"/>
          </lv_slider>
          <text_small text="Extrusion rate" translation_tag="Extrusion rate"/>
        </lv_obj>
      </lv_obj>
      <!-- Reset Speed & Flow Button (under sliders) -->
      <ui_button name="btn_reset" width="100%" icon="refresh" text="Reset Speed &amp; Flow to 100%" translation_tag="Reset Speed &amp; Flow to 100%">
        <event_cb trigger="clicked" callback="on_tune_reset_clicked"/>
      </ui_button>
      <!-- Z-Offset Baby Stepping Section (flex_grow claims remaining space, content aligned to bottom) -->
      <lv_obj name="z_offset_section"
              width="100%" height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xs"
              scrollable="false">
        <!-- Header Row -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" scrollable="false" flex_flow="row"
                style_flex_main_place="space_between" style_flex_cross_place="center">
          <text_body text="Z-Offset" translation_tag="Z-Offset"/>
          <text_heading name="z_offset_display" bind_text="tune_z_offset_display"/>
        </lv_obj>

        <!-- Indicator (left) + Controls (right) side-by-side -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm"
                style_flex_cross_place="stretch" scrollable="false">
          <!-- Nozzle-over-bed visual indicator -->
          <z_offset_indicator name="z_offset_indicator" width="170"/>
          <!-- Controls column: amount buttons row with direction buttons stacked on the right -->
          <lv_obj flex_grow="1"
                  height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xxs"
                  scrollable="false">
            <!-- Amount selectors (left) + direction buttons (right) -->
            <lv_obj width="100%"
                    height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm"
                    style_flex_cross_place="center" scrollable="false">
              <!-- Amount selector buttons (radio-style: one active at a time) -->
              <lv_obj flex_grow="1"
                      height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_xxs"
                      scrollable="false">
                <ui_button flex_grow="1" text="0.05" height="#button_height_sm">
                  <bind_style name="z_step_selected" subject="z_step_0_active" ref_value="1"/>
                  <bind_style name="z_step_unselected" subject="z_step_0_active" ref_value="0"/>
                  <event_cb trigger="clicked" callback="on_tune_z_step" user_data="0"/>
                </ui_button>
                <ui_button flex_grow="1" text="0.025" height="#button_height_sm">
                  <bind_style name="z_step_selected" subject="z_step_1_active" ref_value="1"/>
                  <bind_style name="z_step_unselected" subject="z_step_1_active" ref_value="0"/>
                  <event_cb trigger="clicked" callback="on_tune_z_step" user_data="1"/>
                </ui_button>
                <ui_button flex_grow="1" text="0.01" height="#button_height_sm">
                  <bind_style name="z_step_selected" subject="z_step_2_active" ref_value="1"/>
                  <bind_style name="z_step_unselected" subject="z_step_2_active" ref_value="0"/>
                  <event_cb trigger="clicked" callback="on_tune_z_step" user_data="2"/>
                </ui_button>
                <ui_button flex_grow="1" text="0.005" height="#button_height_sm">
                  <bind_style name="z_step_selected" subject="z_step_3_active" ref_value="1"/>
                  <bind_style name="z_step_unselected" subject="z_step_3_active" ref_value="0"/>
                  <event_cb trigger="clicked" callback="on_tune_z_step" user_data="3"/>
                </ui_button>
              </lv_obj>
              <!-- Direction buttons stacked vertically -->
              <lv_obj width="90"
                      height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xxs"
                      scrollable="false">
                <ui_button width="100%" icon="arrow_down" bind_icon="tune_z_closer_icon">
                  <event_cb trigger="clicked" callback="on_tune_z_adjust" user_data="-1"/>
                </ui_button>
                <ui_button width="100%" icon="arrow_up" bind_icon="tune_z_farther_icon">
                  <event_cb trigger="clicked" callback="on_tune_z_adjust" user_data="1"/>
                </ui_button>
              </lv_obj>
            </lv_obj>
            <!-- Help text -->
            <text_small text="Closer = more squish | Farther = less squish" translation_tag="Closer = more squish | Farther = less squish"/>
          </lv_obj>
        </lv_obj>
        <text_small name="z_offset_help_text" text="Temporary adjustment for this print, unless saved on Controls panel" translation_tag="Temporary adjustment for this print, unless saved on Controls panel"/>
      </lv_obj>
    </lv_obj>
  </view>
</component>
