<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Styles for reactive Z-offset amount button state binding (L040: no inline bg attrs) -->
  <styles>
    <style name="z_amount_selected" bg_color="#primary" bg_opa="255"/>
    <style name="z_amount_unselected" bg_color="#primary" bg_opa="40"/>
  </styles>
  <!-- Print Tuning Panel: Speed and Flow adjustment during active print -->
  <view name="print_tune_panel" extends="overlay_panel" title="Print Tuning" title_tag="Print Tuning">
    <!-- Content Area -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_pad_all="#space_lg" scrollable="false" flex_flow="column"
            style_flex_main_place="start" style_pad_gap="#space_md" flag_overflow_visible="true">
      <!-- Speed + Flow Row (side by side) -->
      <lv_obj name="speed_flow_row"
              width="100%" height="content" style_pad_all="0" scrollable="false" flex_flow="row"
              style_pad_gap="#space_lg" flag_overflow_visible="true">
        <!-- Speed Control (left) -->
        <lv_obj name="speed_section"
                height="content" flex_grow="1" style_pad_all="0" flex_flow="column" style_pad_gap="#space_sm"
                flag_overflow_visible="true" scrollable="false">
          <text_small text="Print Speed" translation_tag="Print Speed"/>
          <text_heading name="speed_display" bind_text="tune_speed_display"/>
          <lv_slider name="speed_slider"
                     width="100%" height="#space_lg" min_value="50" max_value="200" value="100"
                     style_bg_color="#elevated_bg" style_radius="#space_md">
            <event_cb trigger="value_changed" callback="on_tune_speed_display"/>
            <event_cb trigger="released" callback="on_tune_speed_send"/>
          </lv_slider>
          <text_small text="Movement speed" translation_tag="Movement speed"/>
        </lv_obj>
        <!-- Flow Control (right) -->
        <lv_obj name="flow_section"
                height="content" flex_grow="1" style_pad_all="0" flex_flow="column" style_pad_gap="#space_sm"
                flag_overflow_visible="true" scrollable="false">
          <text_small text="Flow Rate" translation_tag="Flow Rate"/>
          <text_heading name="flow_display" bind_text="tune_flow_display"/>
          <lv_slider name="flow_slider"
                     width="100%" height="#space_lg" min_value="75" max_value="125" value="100"
                     style_bg_color="#elevated_bg" style_radius="#space_md">
            <event_cb trigger="value_changed" callback="on_tune_flow_display"/>
            <event_cb trigger="released" callback="on_tune_flow_send"/>
          </lv_slider>
          <text_small text="Extrusion rate" translation_tag="Extrusion rate"/>
        </lv_obj>
      </lv_obj>
      <!-- Reset Speed & Flow Button (under sliders) -->
      <ui_button name="btn_reset" width="100%" icon="refresh" text="Reset Speed &amp; Flow to 100%" translation_tag="Reset Speed &amp; Flow to 100%">
        <event_cb trigger="clicked" callback="on_tune_reset_clicked"/>
      </ui_button>
      <!-- Spacer to push Z-offset to bottom -->
      <lv_obj flex_grow="1" scrollable="false"/>
      <!-- Z-Offset Baby Stepping Section -->
      <lv_obj name="z_offset_section"
              width="100%" height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xs"
              scrollable="false">
        <!-- Header Row -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" scrollable="false" flex_flow="row"
                style_flex_main_place="space_between" style_flex_cross_place="center">
          <text_body text="Z-Offset" translation_tag="Z-Offset"/>
          <text_heading name="z_offset_display" bind_text="tune_z_offset_display"/>
        </lv_obj>

        <!-- Buttons Container: Amount selectors (left) + Up/Down (right) -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" flex_flow="row" style_flex_cross_place="center"
                style_pad_gap="#space_sm" scrollable="false">

          <!-- Amount selector buttons (radio-style, one selected at a time) -->
          <lv_obj flex_grow="1"
                  style_pad_all="0" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xxs"
                  scrollable="false">
            <ui_button name="btn_z_amount_005" flex_grow="1" text="0.05">
              <bind_style name="z_amount_selected" subject="z_amount_005_active" ref_value="1"/>
              <bind_style name="z_amount_unselected" subject="z_amount_005_active" ref_value="0"/>
              <event_cb trigger="clicked" callback="on_tune_z_amount_select" user_data="0.05"/>
            </ui_button>
            <ui_button name="btn_z_amount_0025" flex_grow="1" text="0.025">
              <bind_style name="z_amount_selected" subject="z_amount_0025_active" ref_value="1"/>
              <bind_style name="z_amount_unselected" subject="z_amount_0025_active" ref_value="0"/>
              <event_cb trigger="clicked" callback="on_tune_z_amount_select" user_data="0.025"/>
            </ui_button>
            <ui_button name="btn_z_amount_001" flex_grow="1" text="0.01">
              <bind_style name="z_amount_selected" subject="z_amount_001_active" ref_value="1"/>
              <bind_style name="z_amount_unselected" subject="z_amount_001_active" ref_value="0"/>
              <event_cb trigger="clicked" callback="on_tune_z_amount_select" user_data="0.01"/>
            </ui_button>
            <ui_button name="btn_z_amount_00025" flex_grow="1" text="0.0025">
              <bind_style name="z_amount_selected" subject="z_amount_00025_active" ref_value="1"/>
              <bind_style name="z_amount_unselected" subject="z_amount_00025_active" ref_value="0"/>
              <event_cb trigger="clicked" callback="on_tune_z_amount_select" user_data="0.0025"/>
            </ui_button>
          </lv_obj>
          <!-- Up/Down direction buttons (stacked vertically) -->
          <lv_obj width="56"
                  height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xxs" scrollable="false">
            <!-- Closer button (more squish) - icon depends on kinematics -->
            <ui_button name="btn_z_closer" width="100%">
              <event_cb trigger="clicked" callback="on_tune_z_closer"/>
              <!-- Bed moves Z (CoreXY): bed goes down toward nozzle = arrow_expand_down -->
              <icon src="arrow_expand_down" size="sm">
                <bind_flag_if_eq subject="printer_bed_moves" flag="hidden" ref_value="0"/>
              </icon>
              <!-- Head moves Z (Cartesian): head goes down = arrow_down -->
              <icon src="arrow_down" size="sm">
                <bind_flag_if_eq subject="printer_bed_moves" flag="hidden" ref_value="1"/>
              </icon>
            </ui_button>
            <!-- Farther button (less squish) - icon depends on kinematics -->
            <ui_button name="btn_z_farther" width="100%">
              <event_cb trigger="clicked" callback="on_tune_z_farther"/>
              <!-- Bed moves Z (CoreXY): bed goes up away from nozzle = arrow_expand_up -->
              <icon src="arrow_expand_up" size="sm">
                <bind_flag_if_eq subject="printer_bed_moves" flag="hidden" ref_value="0"/>
              </icon>
              <!-- Head moves Z (Cartesian): head goes up = arrow_up -->
              <icon src="arrow_up" size="sm">
                <bind_flag_if_eq subject="printer_bed_moves" flag="hidden" ref_value="1"/>
              </icon>
            </ui_button>
          </lv_obj>
        </lv_obj>
        <text_small text="Closer = more squish | Farther = less squish" translation_tag="Closer = more squish | Farther = less squish"/>
        <text_small name="z_offset_help_text" text="Temporary adjustment for this print, unless saved on Controls panel" translation_tag="Temporary adjustment for this print, unless saved on Controls panel"/>
      </lv_obj>
    </lv_obj>
  </view>
</component>
