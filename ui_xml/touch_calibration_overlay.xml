<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Touch Calibration Overlay Panel -->
<!-- 3-point touchscreen calibration accessed from Settings -->
<!-- States: 0=IDLE, 1=POINT_1, 2=POINT_2, 3=POINT_3, 4=VERIFY, 5=COMPLETE -->
<!-- Subjects are registered in C++ (init_subjects) - do not define here to avoid shadowing -->
<component>
  <view name="touch_calibration_overlay"
        extends="overlay_panel" width="#overlay_panel_width_full" title="Touch Calibration" title_tag="Touch Calibration" bg_color="#screen_bg">

    <!-- Main content area - full screen for touch capture -->
    <lv_obj name="calibration_content" width="100%" flex_grow="1" style_pad_all="0" scrollable="false">

      <!-- Instruction text (centered, top area) -->
      <text_body name="instruction_label"
                 width="100%" bind_text="touch_cal_instruction" style_text_align="center" style_pad_top="#space_xl"
                 style_pad_left="#space_lg" style_pad_right="#space_lg"/>

      <!-- Crosshair target - positioned dynamically by C++ code -->
      <!-- Uses MDI target icon (U+F04FE) via icon_target constant -->
      <!-- Visible only during POINT_1, POINT_2, POINT_3 (states 1, 2, 3) -->
      <lv_label name="crosshair"
                width="50" height="50" text="#icon_target" style_text_font="mdi_icons_48" style_text_color="#primary"
                style_text_align="center" align="top_left">
        <!-- Bindings control visibility: hidden in states 0, 4, 5 (visible in 1, 2, 3) -->
        <!-- NOTE: Do NOT add hidden="true" base attribute - bindings handle it -->
        <bind_flag_if_eq subject="touch_cal_state" flag="hidden" ref_value="0"/>
        <bind_flag_if_eq subject="touch_cal_state" flag="hidden" ref_value="4"/>
        <bind_flag_if_eq subject="touch_cal_state" flag="hidden" ref_value="5"/>
      </lv_label>

      <!-- Note: Verify marker removed - using ripple effect instead (via ui_create_ripple) -->

      <!-- Touch capture overlay - invisible but captures all touches -->
      <!-- Visible during POINT_1/2/3 (calibration) and VERIFY (accuracy test) -->
      <lv_obj name="touch_capture_overlay" width="100%" height="100%" align="top_left" flag_clickable="true">
        <event_cb trigger="clicked" callback="on_touch_cal_overlay_touched"/>
        <!-- Hidden in COMPLETE state only (visible in 1, 2, 3, 4) -->
        <bind_flag_if_eq subject="touch_cal_state" flag="hidden" ref_value="5"/>
      </lv_obj>

      <!-- Button container (bottom center) -->
      <lv_obj name="button_container"
              width="content" height="content" align="bottom_mid" style_pad_bottom="#space_xl" flex_flow="row"
              style_flex_main_place="center" style_flex_cross_place="center" style_pad_gap="#space_md"
              scrollable="false">

        <!-- Accept button - visible only in VERIFY (state=4) -->
        <ui_button name="btn_accept" width="150" text="Accept" translation_tag="Accept">
          <event_cb trigger="clicked" callback="on_touch_cal_accept_clicked"/>
          <bind_flag_if_not_eq subject="touch_cal_state" flag="hidden" ref_value="4"/>
        </ui_button>

        <!-- Retry button - visible only in VERIFY (state=4) -->
        <ui_button name="btn_retry" width="150" variant="secondary" text="Retry" translation_tag="Retry">
          <event_cb trigger="clicked" callback="on_touch_cal_retry_clicked"/>
          <bind_flag_if_not_eq subject="touch_cal_state" flag="hidden" ref_value="4"/>
        </ui_button>

        <!-- Note: Skip button removed - only relevant for wizard (wizard_touch_calibration.xml) -->
      </lv_obj>
    </lv_obj>
  </view>
</component>
