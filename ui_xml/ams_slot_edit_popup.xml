<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<!-- Compact popup for AMS slot configuration: tool mapping, backup slot, load/unload -->
<component>
  <consts>
    <px name="popup_width" value="180"/>
    <px name="dropdown_width" value="90"/>
  </consts>
  <!-- Full-screen backdrop - tap to dismiss -->
  <view name="slot_edit_popup_backdrop"
        extends="lv_obj" width="100%" height="100%" style_bg_opa="128" style_bg_color="0x000000" style_border_width="0"
        style_pad_all="0" style_radius="0" clickable="true">
    <event_cb trigger="clicked" callback="slot_edit_popup_backdrop_cb"/>
    <!-- Popup card - positioned by C++ code -->
    <lv_obj name="slot_edit_popup"
            width="#popup_width" height="content" style_bg_color="#theme_grey" style_bg_opa="255"
            style_radius="#border_radius" style_border_width="0" style_pad_all="#space_sm" style_pad_gap="#space_xs"
            flex_flow="column" style_flex_main_place="start" style_flex_cross_place="start" scrollable="false"
            clickable="true">
      <!-- Header row: "Slot N" + close button -->
      <lv_obj width="100%"
              height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" flex_flow="row"
              style_flex_main_place="space_between" style_flex_cross_place="center" scrollable="false">
        <text_body name="slot_header" text="Slot 1"/>
        <lv_button name="btn_close"
                   width="28" height="28" style_radius="#border_radius" style_bg_opa="0" style_border_width="0"
                   style_shadow_width="0" clickable="true">
          <event_cb trigger="clicked" callback="slot_edit_popup_close_cb"/>
          <icon src="close" size="sm" variant="secondary" align="center"/>
        </lv_button>
      </lv_obj>
      <!-- Divider -->
      <lv_obj width="100%"
              height="1" style_bg_color="#text_secondary" style_bg_opa="38" style_border_width="0" style_pad_all="0"
              scrollable="false"/>
      <!-- Tool dropdown row (hidden when tool mapping not supported) -->
      <lv_obj name="tool_row"
              width="100%" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0"
              style_pad_top="#space_xs" flex_flow="row" style_flex_main_place="space_between"
              style_flex_cross_place="center" scrollable="false" hidden="true">
        <text_small text="Tool" style_text_color="#text_secondary"/>
        <lv_dropdown name="tool_dropdown"
                     width="#dropdown_width" height="32" style_radius="#border_radius" style_border_width="0">
          <event_cb trigger="value_changed" callback="slot_edit_popup_tool_changed_cb"/>
        </lv_dropdown>
      </lv_obj>
      <!-- Backup dropdown row (hidden when endless spool not supported) -->
      <lv_obj name="backup_row"
              width="100%" height="content" style_bg_opa="0" style_border_width="0" style_pad_all="0" flex_flow="row"
              style_flex_main_place="space_between" style_flex_cross_place="center" scrollable="false" hidden="true">
        <text_small text="Backup" style_text_color="#text_secondary"/>
        <lv_dropdown name="backup_dropdown"
                     width="#dropdown_width" height="32" style_radius="#border_radius" style_border_width="0">
          <event_cb trigger="value_changed" callback="slot_edit_popup_backup_changed_cb"/>
        </lv_dropdown>
      </lv_obj>
      <!-- Divider before buttons (hidden when no dropdowns visible) -->
      <lv_obj name="button_divider"
              width="100%" height="1" style_bg_color="#text_secondary" style_bg_opa="38" style_border_width="0"
              style_pad_all="0" style_margin_top="#space_xs" scrollable="false" hidden="true"/>
      <!-- Load button -->
      <lv_button name="btn_load"
                 width="100%" height="#button_height_sm" style_radius="#border_radius" style_border_width="0"
                 style_shadow_width="0" style_bg_opa="0" flex_flow="row" style_flex_main_place="start"
                 style_flex_cross_place="center" style_pad_left="#space_sm" style_pad_gap="#space_sm" clickable="true">
        <bind_state_if_eq subject="slot_edit_can_load" state="disabled" ref_value="0"/>
        <icon src="z_closer" size="sm" variant="primary"/>
        <text_body text="Load"/>
        <event_cb trigger="clicked" callback="slot_edit_popup_load_cb"/>
      </lv_button>
      <!-- Unload button -->
      <lv_button name="btn_unload"
                 width="100%" height="#button_height_sm" style_radius="#border_radius" style_border_width="0"
                 style_shadow_width="0" style_bg_opa="0" flex_flow="row" style_flex_main_place="start"
                 style_flex_cross_place="center" style_pad_left="#space_sm" style_pad_gap="#space_sm" clickable="true">
        <bind_state_if_eq subject="slot_edit_can_unload" state="disabled" ref_value="0"/>
        <icon src="z_farther" size="sm" variant="primary"/>
        <text_body text="Unload"/>
        <event_cb trigger="clicked" callback="slot_edit_popup_unload_cb"/>
      </lv_button>
    </lv_obj>
  </view>
</component>
