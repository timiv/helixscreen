<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Print History Detail Overlay - Compact horizontal layout -->
  <!-- Layout: Thumbnail (40%) | Metadata + Buttons (60%) -->
  <!--
    Required subjects (initialized by HistoryListPanel):
    - history_detail_filename: Job filename
    - history_detail_status: Status text (Completed/Failed/Cancelled)
    - history_detail_status_icon: MDI icon name (check-circle/alert-circle/cancel)
    - history_detail_status_variant: Theme variant (success/error/warning)
    - history_detail_start_time: Formatted start timestamp
    - history_detail_end_time: Formatted end timestamp
    - history_detail_duration: Formatted duration
    - history_detail_layers: Layer count string
    - history_detail_layer_height: Layer height string
    - history_detail_nozzle_temp: Nozzle temp string
    - history_detail_bed_temp: Bed temp string
    - history_detail_filament: Filament used string
    - history_detail_filament_type: Filament type (PLA/PETG/etc)
    - history_detail_can_reprint: 1 if file exists, 0 otherwise
    - history_detail_thumbnail: Path to thumbnail image (may be empty)
    - history_detail_has_timelapse: 1 if timelapse available, 0 otherwise
  -->
  <view name="history_detail_overlay" extends="overlay_panel" title="Print Details" title_tag="Print Details">
    <!-- Content Area - Horizontal split -->
    <lv_obj name="overlay_content"
            width="100%" flex_grow="1" style_pad_all="#space_md" scrollable="false" flex_flow="row"
            style_pad_gap="#space_md">
      <!-- LEFT: Thumbnail Section (40%) -->
      <lv_obj name="thumbnail_section"
              height="100%" flex_grow="4" style_pad_all="0" scrollable="false" flex_flow="column">
        <!-- Thumbnail card with clip corner for overlay effect -->
        <ui_card name="thumbnail_card"
                 width="100%" flex_grow="1" style_radius="#border_radius" style_pad_all="0" style_clip_corner="true"
                 scrollable="false">
          <!-- Pre-rendered gradient background (source updated by C++ on theme switch) -->
          <lv_image name="gradient_bg" width="100%" height="100%" src="A:assets/images/gradient-panel-medium-dark.bin"/>
          <!-- Fallback shown when no thumbnail (centered) -->
          <lv_obj name="thumbnail_fallback"
                  width="100%" height="100%" style_pad_all="0" flex_flow="column" style_flex_main_place="center"
                  style_flex_cross_place="center" scrollable="false" align="center">
            <icon src="printer_3d" size="xl" variant="secondary"/>
            <text_small text="No preview" translation_tag="No preview" style_margin_top="#space_sm"/>
          </lv_obj>
          <!-- Actual thumbnail (overlays fallback when available) -->
          <!-- Note: Image will be set programmatically when available -->
          <lv_image name="thumbnail_image"
                    width="100%" height="100%" hidden="true" align="center" inner_align="contain"
                    style_translate_y="#preview_offset_y"/>
          <!-- Metadata clip container - clips top rounded corners of inner overlay -->
          <lv_obj name="filename_clip"
                  width="100%" height="55" style_radius="0" style_pad_all="0" align="bottom_mid" scrollable="false">
            <!-- Inner overlay with rounded corners - taller to hide top radius -->
            <lv_obj name="filename_overlay"
                    width="100%" height="63" style_bg_opa="160" style_radius="#border_radius" style_pad_left="#space_sm"
                    style_pad_right="#space_sm" style_pad_top="#space_md" style_pad_bottom="#space_sm"
                    align="bottom_mid" flex_flow="column" scrollable="false">
              <!-- Filename label (single line, truncated with ...) -->
              <text_body name="detail_filename"
                         width="100%" height="24" bind_text="history_detail_filename" long_mode="dots"/>
            </lv_obj>
          </lv_obj>
        </ui_card>
      </lv_obj>
      <!-- RIGHT: Metadata + Buttons Section (60%) -->
      <lv_obj name="metadata_section"
              height="100%" flex_grow="6" style_pad_all="0" scrollable="false" flex_flow="column"
              style_pad_gap="#space_sm">
        <!-- Status row with icon (multiple icons, show/hide based on status) -->
        <!-- Status values: 0=completed, 1=cancelled, 2=error, 3=in_progress -->
        <lv_obj name="status_section"
                width="100%" height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_xs"
                style_flex_cross_place="center" style_flex_track_place="center" scrollable="false">
          <!-- Completed icon (status=0) -->
          <icon name="status_icon_completed" src="check_circle" size="sm" variant="success">
            <bind_flag_if_not_eq subject="history_detail_status_code" flag="hidden" ref_value="0"/>
          </icon>
          <!-- Cancelled icon (status=1) -->
          <icon name="status_icon_cancelled" src="close_circle" size="sm" variant="warning" hidden="true">
            <bind_flag_if_not_eq subject="history_detail_status_code" flag="hidden" ref_value="1"/>
          </icon>
          <!-- Error icon (status=2) -->
          <icon name="status_icon_error" src="alert" size="sm" variant="danger" hidden="true">
            <bind_flag_if_not_eq subject="history_detail_status_code" flag="hidden" ref_value="2"/>
          </icon>
          <!-- In Progress icon (status=3) -->
          <icon name="status_icon_progress" src="clock" size="sm" variant="secondary" hidden="true">
            <bind_flag_if_not_eq subject="history_detail_status_code" flag="hidden" ref_value="3"/>
          </icon>
          <text_body name="status_label" bind_text="history_detail_status"/>
        </lv_obj>
        <!-- Metadata grid (3 columns Ã— 3 rows) -->
        <lv_obj name="metadata_grid"
                width="100%" height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_xs"
                scrollable="false">
          <!-- Row 1: Started | Ended | Duration -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm" scrollable="false">
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Started" translation_tag="Started"/>
              <text_body name="start_time_label" bind_text="history_detail_start_time"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Ended" translation_tag="Ended"/>
              <text_body name="end_time_label" bind_text="history_detail_end_time"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Duration" translation_tag="Duration"/>
              <text_body name="duration_label" bind_text="history_detail_duration"/>
            </lv_obj>
          </lv_obj>
          <!-- Row 2: Layers | Nozzle | Bed Temp -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm" scrollable="false">
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Layers" translation_tag="Layers"/>
              <text_body name="layers_label" bind_text="history_detail_layers"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Nozzle" translation_tag="Nozzle"/>
              <text_body name="nozzle_temp_label" bind_text="history_detail_nozzle_temp"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Bed" translation_tag="Bed"/>
              <text_body name="bed_temp_label" bind_text="history_detail_bed_temp"/>
            </lv_obj>
          </lv_obj>
          <!-- Row 3: Filament | Type | Layer Height -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm" scrollable="false">
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Filament" translation_tag="Filament"/>
              <text_body name="filament_label" bind_text="history_detail_filament"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Type" translation_tag="Type"/>
              <text_body name="filament_type_label" bind_text="history_detail_filament_type"/>
            </lv_obj>
            <lv_obj flex_grow="1" style_pad_all="0" flex_flow="column" scrollable="false">
              <text_small text="Layer Height" translation_tag="Layer Height"/>
              <text_body name="layer_height_label" bind_text="history_detail_layer_height"/>
            </lv_obj>
          </lv_obj>
        </lv_obj>
        <!-- Timelapse section (shown when timelapse is available) -->
        <lv_obj name="timelapse_section"
                width="100%" height="content" style_pad_all="0" flex_flow="column" style_pad_gap="#space_sm"
                scrollable="false">
          <bind_flag_if_eq subject="history_detail_has_timelapse" flag="hidden" ref_value="0"/>
          <!-- Label row with icon -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" flex_flow="row" style_pad_gap="#space_sm"
                  style_flex_cross_place="center" scrollable="false">
            <icon src="video" size="sm" variant="primary"/>
            <text_muted text="Timelapse Available" translation_tag="Timelapse Available"/>
          </lv_obj>
          <!-- View Timelapse button -->
          <ui_button name="view_timelapse_btn"
                     width="100%" height="#button_height_sm" text="View Timelapse" translation_tag="View Timelapse" variant="secondary">
            <event_cb trigger="clicked" callback="history_detail_view_timelapse"/>
          </ui_button>
        </lv_obj>
        <!-- Spacer to push buttons to bottom -->
        <lv_obj width="100%" flex_grow="1" scrollable="false"/>
        <!-- Action buttons row -->
        <lv_obj name="button_row"
                width="100%" height="content" style_pad_all="0" style_pad_gap="#space_sm" flex_flow="row"
                scrollable="false">
          <!-- Delete button (secondary style) -->
          <ui_button name="delete_button" text="Delete" translation_tag="Delete" variant="success" flex_grow="1">
            <event_cb trigger="clicked" callback="history_detail_delete"/>
          </ui_button>
          <!-- Reprint button (primary, disabled if file doesn't exist) -->
          <ui_button name="reprint_button" text="Reprint" translation_tag="Reprint" flex_grow="1">
            <event_cb trigger="clicked" callback="history_detail_reprint"/>
            <bind_state_if_eq subject="history_detail_can_reprint" state="disabled" ref_value="0"/>
          </ui_button>
        </lv_obj>
      </lv_obj>
    </lv_obj>
  </view>
</component>
