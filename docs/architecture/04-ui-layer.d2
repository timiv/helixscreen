# HelixScreen UI Layer
direction: down

title: {
  label: UI Layer Architecture
  near: top-center
  shape: text
  style.font-size: 28
  style.bold: true
}

nav: {
  label: "Navigation Bar (sidebar)"
  style.fill: "#533483"
  style.font-color: "#fff"

  home: "Home" { shape: rectangle; style.fill: "#7b2d8e" }
  print: "Print" { shape: rectangle; style.fill: "#7b2d8e" }
  controls: "Controls" { shape: rectangle; style.fill: "#7b2d8e" }
  filament: "Filament" { shape: rectangle; style.fill: "#7b2d8e" }
  settings: "Settings" { shape: rectangle; style.fill: "#7b2d8e" }
  advanced: "Advanced" { shape: rectangle; style.fill: "#7b2d8e" }
}

navmgr: {
  label: "NavigationManager (singleton)"
  style.fill: "#0f3460"
  style.font-color: "#fff"

  panel_stack: "Panel Stack\n(one active at a time)" { shape: rectangle }
  overlay_stack: "Overlay Stack\n(push/pop, nested)" { shape: rectangle }
  backdrop: "Backdrop Manager\n(shared + per-overlay)" { shape: rectangle }
  lifecycle: "Lifecycle Dispatch\non_activate() / on_deactivate()" { shape: rectangle }

  panel_stack -> lifecycle
  overlay_stack -> lifecycle
  overlay_stack -> backdrop
}

nav.home -> navmgr.panel_stack
nav.print -> navmgr.panel_stack
nav.controls -> navmgr.panel_stack
nav.filament -> navmgr.panel_stack
nav.settings -> navmgr.panel_stack
nav.advanced -> navmgr.panel_stack

panels: {
  label: "Main Panels (extend PanelBase)"
  style.fill: "#533483"
  style.font-color: "#fff"

  home: "HomePanel\nDashboard, quick print card,\nprinter image, tips, LED toggle" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
  print: "PrintSelectPanel\nFile browser: card/list view\nSort, search, thumbnails" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
  controls: "ControlsPanel\n5 smart cards:\nActions | Temps | Fans\nCalibration | Quick access" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
  filament: "FilamentPanel\nLoad/unload, material presets\nPLA 210° | PETG 240° | ABS 250°" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
  settings: "SettingsPanel\nDisplay, sound, sensors,\nLED, plugins, about" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
  advanced: "AdvancedPanel\nPower, macros, console,\ndebug, memory stats" {
    shape: rectangle; style.fill: "#7b2d8e"
  }
}

overlays: {
  label: "Overlays (extend OverlayBase)"
  style.fill: "#2b5876"
  style.font-color: "#fff"

  status: {
    label: "Status (pinned)"
    style.fill: "#1b4332"

    motion: "MotionPanel\nXYZ jog + homing"
    print_status: "PrintStatusPanel\nProgress, thumbnail,\nspeed/flow, pause/cancel"
  }

  calibration: {
    label: "Calibration"
    style.fill: "#3d405b"

    bed_mesh: BedMeshPanel
    z_offset: ZOffsetCalibrationPanel
    pid: PidCalibrationPanel
    screws: ScrewsTiltPanel
    probe: ProbeOverlay
    input_shaper: InputShaperPanel
    touch: TouchCalibrationOverlay
  }

  settings_sub: {
    label: "Settings Sub-panels"
    style.fill: "#3d405b"

    display: DisplaySettings
    sound: SoundSettings
    sensors: SensorSettings
    led: LedSettings
    hw_health: HardwareHealth
    limits: MachineLimits
    plugins: PluginsSettings
    macro_btn: MacroButtons
    about: About
    telemetry: TelemetryData
  }

  features: {
    label: "Features"
    style.fill: "#3d405b"

    ams: "AmsPanel\n(multi-backend)"
    ams_overview: AmsOverview
    spoolman: SpoolmanPanel
    spool_wizard: SpoolWizard
    history_dash: HistoryDashboard
    history_list: HistoryList
    console: ConsolePanel
    macros: MacrosPanel
    power: PowerPanel
    notif_hist: NotificationHistory
    network: NetworkSettings
    tune: PrintTuneOverlay
    fan: FanControlOverlay
    led_ctrl: LedControlOverlay
    theme: ThemeEditorOverlay
    timelapse: TimelapseSettings
    retraction: RetractionSettings
    printer_img: PrinterImageOverlay
    printer_mgr: PrinterManager
    exclude: ExcludeObjects
  }
}

modals: {
  label: "Modals (extend Modal)"
  style.fill: "#5c2018"
  style.font-color: "#fff"

  cancel: PrintCancelModal
  z_save: SaveZOffsetModal
  ams_edit: AmsEditModal
  ams_err: AmsLoadingErrorModal
  exclude: ExcludeObjectModal
  host: ChangeHostModal
  runout: RunoutGuidanceModal
  plugin: PluginInstallModal
  action: ActionPromptModal
  spool_edit: SpoolEditModal
  crash: CrashReportModal
  debug: DebugBundleModal
}

# Panel → Overlay triggers
panels.home -> overlays.status.motion: "tap temp card"
panels.home -> overlays.status.print_status: "tap print card"
panels.settings -> overlays.settings_sub.display: "display row"
panels.settings -> overlays.settings_sub.sound: "sound row"
panels.controls -> overlays.calibration.bed_mesh: "bed mesh card"
panels.controls -> overlays.calibration.z_offset: "z-offset card"
panels.advanced -> overlays.features.macros: "macros"
panels.advanced -> overlays.features.console: "console"
panels.advanced -> overlays.features.power: "power"

# Overlay → Modal triggers
overlays.status.print_status -> modals.cancel: "cancel button" { style.stroke: "#ef476f" }
overlays.features.ams -> modals.ams_edit: "edit slot" { style.stroke: "#ef476f" }
overlays.features.ams -> modals.ams_err: "load error" { style.stroke: "#ef476f" }

navmgr.panel_stack -> panels: "activate" { style.stroke: "#00b4d8" }
navmgr.overlay_stack -> overlays: "push/pop" { style.stroke: "#00b4d8" }
